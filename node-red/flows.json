[
    {
        "id": "bf163cd5.f84c",
        "type": "tab",
        "label": "Office Light Button",
        "disabled": false,
        "info": ""
    },
    {
        "id": "4c3e78a1.ebb138",
        "type": "tab",
        "label": "Master Bedroom Light Button",
        "disabled": false,
        "info": ""
    },
    {
        "id": "7b5378f9.154968",
        "type": "tab",
        "label": "Kitchen Light Button",
        "disabled": false,
        "info": ""
    },
    {
        "id": "1d296556.09592b",
        "type": "tab",
        "label": "Foyer Motion",
        "disabled": false,
        "info": ""
    },
    {
        "id": "62ce34cf.a7671c",
        "type": "tab",
        "label": "Upstairs Hallway Motion",
        "disabled": false,
        "info": ""
    },
    {
        "id": "35ab222c.a6eb9e",
        "type": "tab",
        "label": "Downstairs Hallway Motion",
        "disabled": false,
        "info": ""
    },
    {
        "id": "e9868773.797078",
        "type": "tab",
        "label": "Front Door Entry/Exit",
        "disabled": false,
        "info": ""
    },
    {
        "id": "884319a9.e92148",
        "type": "tab",
        "label": "Kitchen Door Entry/Exit",
        "disabled": false,
        "info": ""
    },
    {
        "id": "390fc521.dffd0a",
        "type": "tab",
        "label": "Living Room Media",
        "disabled": false,
        "info": ""
    },
    {
        "id": "3aefc8fa.f61958",
        "type": "tab",
        "label": "Relinquish to Motion",
        "disabled": false,
        "info": ""
    },
    {
        "id": "c35af4f2.4cd108",
        "type": "tab",
        "label": "Phone Location",
        "disabled": false,
        "info": ""
    },
    {
        "id": "66eaa4d8.773f4c",
        "type": "tab",
        "label": "Skip Next on Yamaha",
        "disabled": false,
        "info": ""
    },
    {
        "id": "bec3a76b.4b57e8",
        "type": "tab",
        "label": "Alarm Triggered",
        "disabled": false,
        "info": ""
    },
    {
        "id": "5a3565e2.10464c",
        "type": "tab",
        "label": "Example S/R",
        "disabled": false,
        "info": ""
    },
    {
        "id": "e393795c.3d6e88",
        "type": "tab",
        "label": "Start Mercedes",
        "disabled": false,
        "info": ""
    },
    {
        "id": "8c544039.d793b",
        "type": "tab",
        "label": "Plex Sync Play",
        "disabled": false,
        "info": ""
    },
    {
        "id": "e6c80f9f.2d85a",
        "type": "tab",
        "label": "Laundry Room Button",
        "disabled": false,
        "info": ""
    },
    {
        "id": "7a29c613.b063d8",
        "type": "tab",
        "label": "Living Room Switch",
        "disabled": false,
        "info": ""
    },
    {
        "id": "2f5bd1e0.67e40e",
        "type": "server",
        "z": "",
        "name": "Home Assistant",
        "legacy": false,
        "rejectUnauthorizedCerts": true,
        "ha_boolean": "y|yes|true|on|home|open",
        "connectionDelay": true,
        "cacheJson": true
    },
    {
        "id": "3cae343.22b5bcc",
        "type": "server-events",
        "z": "bf163cd5.f84c",
        "name": " Deconz Event (any)",
        "server": "2f5bd1e0.67e40e",
        "event_type": "deconz_event",
        "x": 130,
        "y": 400,
        "wires": [
            [
                "d23b825e.b2605"
            ]
        ]
    },
    {
        "id": "d23b825e.b2605",
        "type": "switch",
        "z": "bf163cd5.f84c",
        "name": "Is Office Button?",
        "property": "payload.event.id",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "button_st_office",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 120,
        "y": 520,
        "wires": [
            [
                "3e59fa2.e73b206"
            ]
        ]
    },
    {
        "id": "3b8bc8cf.939ae8",
        "type": "api-call-service",
        "z": "bf163cd5.f84c",
        "name": "Toggle office lights",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "light",
        "service": "toggle",
        "entityId": "group.office",
        "data": "",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 550,
        "y": 520,
        "wires": [
            [
                "ac86b665.134f48"
            ]
        ]
    },
    {
        "id": "3e59fa2.e73b206",
        "type": "switch",
        "z": "bf163cd5.f84c",
        "name": "Is press?",
        "property": "payload.event.event",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "1002",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 340,
        "y": 520,
        "wires": [
            [
                "3b8bc8cf.939ae8"
            ]
        ],
        "info": "### Samsung button event codes\n - 1001: Long press\n - 1002: Single press\n - 1004: Double press"
    },
    {
        "id": "ac86b665.134f48",
        "type": "api-call-service",
        "z": "bf163cd5.f84c",
        "name": "Log execution to HA logbook",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "logbook",
        "service": "log",
        "entityId": "",
        "data": "{\"name\":\"node-red\",\"message\":\"Office Light Button flow executed successfully.\",\"domain\":\"automation\"}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 840,
        "y": 520,
        "wires": [
            []
        ]
    },
    {
        "id": "a30fb6e1.491408",
        "type": "server-events",
        "z": "4c3e78a1.ebb138",
        "name": " Deconz Event (any)",
        "server": "2f5bd1e0.67e40e",
        "event_type": "deconz_event",
        "x": 90,
        "y": 460,
        "wires": [
            [
                "aad4aa21.577a98"
            ]
        ]
    },
    {
        "id": "aad4aa21.577a98",
        "type": "switch",
        "z": "4c3e78a1.ebb138",
        "name": "Is Master Bedroom Button?",
        "property": "payload.event.id",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "button_st_master_bedroom",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 120,
        "y": 580,
        "wires": [
            [
                "b3772296.72252"
            ]
        ]
    },
    {
        "id": "52b13ab7.819424",
        "type": "api-call-service",
        "z": "4c3e78a1.ebb138",
        "name": "Toggle master bedroom lights",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "light",
        "service": "toggle",
        "entityId": "group.master_bedroom",
        "data": "",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 570,
        "y": 580,
        "wires": [
            [
                "17f19bed.57f464"
            ]
        ]
    },
    {
        "id": "b3772296.72252",
        "type": "switch",
        "z": "4c3e78a1.ebb138",
        "name": "Is press?",
        "property": "payload.event.event",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "1002",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 340,
        "y": 580,
        "wires": [
            [
                "52b13ab7.819424"
            ]
        ],
        "info": "### Samsung button event codes\n - 1001: Long press\n - 1002: Single press\n - 1004: Double press"
    },
    {
        "id": "17f19bed.57f464",
        "type": "api-call-service",
        "z": "4c3e78a1.ebb138",
        "name": "Log execution to HA logbook",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "logbook",
        "service": "log",
        "entityId": "",
        "data": "{\"name\":\"node-red\",\"message\":\"Master Bedroom Light Button flow executed successfully.\",\"domain\":\"automation\"}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 880,
        "y": 580,
        "wires": [
            []
        ]
    },
    {
        "id": "b5afe504.c99e68",
        "type": "server-events",
        "z": "7b5378f9.154968",
        "name": " Deconz Event (any)",
        "server": "2f5bd1e0.67e40e",
        "event_type": "deconz_event",
        "x": 90,
        "y": 440,
        "wires": [
            [
                "50780152.d8fb8"
            ]
        ]
    },
    {
        "id": "50780152.d8fb8",
        "type": "switch",
        "z": "7b5378f9.154968",
        "name": "Is Kitchen Button?",
        "property": "payload.event.id",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "button_st_kitchen",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 90,
        "y": 560,
        "wires": [
            [
                "57754fcc.df72e"
            ]
        ]
    },
    {
        "id": "e1166209.a2d2e",
        "type": "api-call-service",
        "z": "7b5378f9.154968",
        "name": "Toggle kitchen lights",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "light",
        "service": "toggle",
        "entityId": "group.kitchen",
        "data": "",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 520,
        "y": 560,
        "wires": [
            [
                "5c4fa7d4.fd52b8"
            ]
        ]
    },
    {
        "id": "57754fcc.df72e",
        "type": "switch",
        "z": "7b5378f9.154968",
        "name": "Is press?",
        "property": "payload.event.event",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "1002",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 300,
        "y": 560,
        "wires": [
            [
                "e1166209.a2d2e"
            ]
        ],
        "info": "### Samsung button event codes\n - 1001: Long press\n - 1002: Single press\n - 1004: Double press"
    },
    {
        "id": "5c4fa7d4.fd52b8",
        "type": "api-call-service",
        "z": "7b5378f9.154968",
        "name": "Log execution to HA logbook",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "logbook",
        "service": "log",
        "entityId": "",
        "data": "{\"name\":\"node-red\",\"message\":\"Kitchen Light Button flow executed successfully.\",\"domain\":\"automation\"}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 800,
        "y": 560,
        "wires": [
            []
        ]
    },
    {
        "id": "948486bf.0ffe48",
        "type": "server-state-changed",
        "z": "1d296556.09592b",
        "name": "Foyer Motion Event",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "entityidfilter": "binary_sensor.motion_sensor_hue_foyer",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "",
        "halt_if_type": "jsonata",
        "halt_if_compare": "is",
        "outputs": 1,
        "output_only_on_state_change": true,
        "x": 110,
        "y": 440,
        "wires": [
            [
                "cd526cf1.d6312"
            ]
        ]
    },
    {
        "id": "cd526cf1.d6312",
        "type": "switch",
        "z": "1d296556.09592b",
        "name": "Motion On or Off?",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "on",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "off",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 150,
        "y": 580,
        "wires": [
            [
                "881f2136.3abd6",
                "1e3cfe7.c8f8702"
            ],
            [
                "af9ec202.685c7"
            ]
        ]
    },
    {
        "id": "7c5a2e5c.bd53",
        "type": "api-current-state",
        "z": "1d296556.09592b",
        "name": "Light not on yet?",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "outputs": 2,
        "halt_if": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is_not",
        "override_topic": false,
        "entity_id": "light.foyer",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 630,
        "y": 500,
        "wires": [
            [
                "442100ee.26b29",
                "37b07451.e12c2c"
            ],
            []
        ]
    },
    {
        "id": "37b07451.e12c2c",
        "type": "api-call-service",
        "z": "1d296556.09592b",
        "name": "Turn on light",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "light",
        "service": "turn_on",
        "entityId": "light.foyer",
        "data": "{\"brightness_pct\":100}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 910,
        "y": 520,
        "wires": [
            [
                "4160fc3e.761454"
            ]
        ]
    },
    {
        "id": "d2caa878.c990f8",
        "type": "change",
        "z": "1d296556.09592b",
        "name": "Stop timer msg",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "stop",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 520,
        "y": 620,
        "wires": [
            [
                "c6f41175.b52d8"
            ]
        ]
    },
    {
        "id": "c6f41175.b52d8",
        "type": "stoptimer",
        "z": "1d296556.09592b",
        "duration": "5",
        "units": "Minute",
        "payloadtype": "num",
        "payloadval": "0",
        "name": "",
        "x": 680,
        "y": 700,
        "wires": [
            [
                "c4018f.d5e0ee7",
                "9ffcaf57.a5da"
            ],
            []
        ]
    },
    {
        "id": "c4018f.d5e0ee7",
        "type": "api-call-service",
        "z": "1d296556.09592b",
        "name": "Turn off light",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "light",
        "service": "turn_off",
        "entityId": "light.foyer",
        "data": "",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 910,
        "y": 700,
        "wires": [
            [
                "4160fc3e.761454"
            ]
        ]
    },
    {
        "id": "442100ee.26b29",
        "type": "change",
        "z": "1d296556.09592b",
        "name": "Mark light on by motion",
        "rules": [
            {
                "t": "set",
                "p": "did_turn_light_on",
                "pt": "flow",
                "to": "true",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 950,
        "y": 460,
        "wires": [
            []
        ]
    },
    {
        "id": "af9ec202.685c7",
        "type": "switch",
        "z": "1d296556.09592b",
        "name": "Is on from motion?",
        "property": "did_turn_light_on",
        "propertyType": "flow",
        "rules": [
            {
                "t": "true"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 390,
        "y": 700,
        "wires": [
            [
                "c6f41175.b52d8"
            ]
        ]
    },
    {
        "id": "881f2136.3abd6",
        "type": "api-current-state",
        "z": "1d296556.09592b",
        "name": "Is dark?",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "outputs": 2,
        "halt_if": "below_horizon",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "sun.sun",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 360,
        "y": 540,
        "wires": [
            [
                "7c5a2e5c.bd53",
                "d2caa878.c990f8"
            ],
            []
        ]
    },
    {
        "id": "9ffcaf57.a5da",
        "type": "change",
        "z": "1d296556.09592b",
        "name": "Clear light on by motion or user",
        "rules": [
            {
                "t": "set",
                "p": "did_turn_light_on",
                "pt": "flow",
                "to": "false",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 990,
        "y": 780,
        "wires": [
            []
        ]
    },
    {
        "id": "4160fc3e.761454",
        "type": "api-call-service",
        "z": "1d296556.09592b",
        "name": "Log execution to HA logbook",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "logbook",
        "service": "log",
        "entityId": "",
        "data": "{\"name\":\"node-red\",\"message\":\"Foyer Motion flow executed successfully.\",\"domain\":\"automation\"}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 1180,
        "y": 620,
        "wires": [
            []
        ]
    },
    {
        "id": "802a930e.b1d55",
        "type": "server-state-changed",
        "z": "1d296556.09592b",
        "name": "Was light turned off by this or user?",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "light.foyer",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "off",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 640,
        "y": 820,
        "wires": [
            [
                "9ffcaf57.a5da"
            ],
            []
        ]
    },
    {
        "id": "8197cbd2.35fcd8",
        "type": "server-state-changed",
        "z": "62ce34cf.a7671c",
        "name": "Foyer Motion Event",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "binary_sensor.motion_sensor_eco_upstairs_hallway",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "",
        "halt_if_type": "jsonata",
        "halt_if_compare": "is",
        "outputs": 1,
        "output_only_on_state_change": true,
        "x": 90,
        "y": 540,
        "wires": [
            [
                "fb3e86e1.e68a28"
            ]
        ]
    },
    {
        "id": "fb3e86e1.e68a28",
        "type": "switch",
        "z": "62ce34cf.a7671c",
        "name": "Motion On or Off?",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "on",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "off",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 130,
        "y": 680,
        "wires": [
            [
                "ad0c1937.a3d408",
                "e2377e7b.8d444"
            ],
            [
                "eb2fd5d5.268818"
            ]
        ]
    },
    {
        "id": "7a861800.e44a98",
        "type": "api-current-state",
        "z": "62ce34cf.a7671c",
        "name": "Light not on yet?",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "outputs": 2,
        "halt_if": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is_not",
        "override_topic": false,
        "entity_id": "group.upstairs_hallway",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 610,
        "y": 600,
        "wires": [
            [
                "dd8ba79c.bea668",
                "55c8cbae.a6c8e4"
            ],
            []
        ]
    },
    {
        "id": "7f74d9fe.189ad8",
        "type": "api-call-service",
        "z": "62ce34cf.a7671c",
        "name": "Turn on light (max)",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "light",
        "service": "turn_on",
        "entityId": "group.upstairs_hallway",
        "data": "{\"brightness_pct\":100}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 1070,
        "y": 700,
        "wires": [
            [
                "d9ab294f.c1d178"
            ]
        ]
    },
    {
        "id": "ba91b17f.0c531",
        "type": "change",
        "z": "62ce34cf.a7671c",
        "name": "Stop timer msg",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "stop",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 500,
        "y": 720,
        "wires": [
            [
                "cfe91e14.483f7"
            ]
        ]
    },
    {
        "id": "cfe91e14.483f7",
        "type": "stoptimer",
        "z": "62ce34cf.a7671c",
        "duration": "2",
        "units": "Minute",
        "payloadtype": "num",
        "payloadval": "0",
        "name": "",
        "x": 660,
        "y": 800,
        "wires": [
            [
                "dc2ca952.cc4cb8",
                "d36ab12a.bf533"
            ],
            []
        ]
    },
    {
        "id": "dc2ca952.cc4cb8",
        "type": "api-call-service",
        "z": "62ce34cf.a7671c",
        "name": "Turn off light",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "light",
        "service": "turn_off",
        "entityId": "group.upstairs_hallway",
        "data": "",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 1030,
        "y": 820,
        "wires": [
            [
                "d9ab294f.c1d178"
            ]
        ]
    },
    {
        "id": "dd8ba79c.bea668",
        "type": "change",
        "z": "62ce34cf.a7671c",
        "name": "Mark light on by motion",
        "rules": [
            {
                "t": "set",
                "p": "did_turn_light_on",
                "pt": "flow",
                "to": "true",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 930,
        "y": 560,
        "wires": [
            []
        ]
    },
    {
        "id": "eb2fd5d5.268818",
        "type": "switch",
        "z": "62ce34cf.a7671c",
        "name": "Is on from motion?",
        "property": "did_turn_light_on",
        "propertyType": "flow",
        "rules": [
            {
                "t": "true"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 370,
        "y": 800,
        "wires": [
            [
                "cfe91e14.483f7"
            ]
        ]
    },
    {
        "id": "ad0c1937.a3d408",
        "type": "api-current-state",
        "z": "62ce34cf.a7671c",
        "name": "Is dark?",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "outputs": 2,
        "halt_if": "below_horizon",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "sun.sun",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 360,
        "y": 640,
        "wires": [
            [
                "7a861800.e44a98",
                "ba91b17f.0c531"
            ],
            []
        ]
    },
    {
        "id": "d36ab12a.bf533",
        "type": "change",
        "z": "62ce34cf.a7671c",
        "name": "Clear light on by motion or user",
        "rules": [
            {
                "t": "set",
                "p": "did_turn_light_on",
                "pt": "flow",
                "to": "false",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 970,
        "y": 880,
        "wires": [
            []
        ]
    },
    {
        "id": "d9ab294f.c1d178",
        "type": "api-call-service",
        "z": "62ce34cf.a7671c",
        "name": "Log execution to HA logbook",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "logbook",
        "service": "log",
        "entityId": "",
        "data": "{\"name\":\"node-red\",\"message\":\"Upstairs Hallway Motion flow executed successfully.\",\"domain\":\"automation\"}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 1380,
        "y": 740,
        "wires": [
            []
        ]
    },
    {
        "id": "218b1457.7387ac",
        "type": "server-state-changed",
        "z": "62ce34cf.a7671c",
        "name": "Was light turned off by this or user?",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "group.upstairs_hallway",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "off",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 620,
        "y": 920,
        "wires": [
            [
                "d36ab12a.bf533"
            ],
            []
        ]
    },
    {
        "id": "55c8cbae.a6c8e4",
        "type": "time-range-switch",
        "z": "62ce34cf.a7671c",
        "name": "Is night-light time?",
        "lat": "",
        "lon": "",
        "startTime": "21:00",
        "endTime": "05:00",
        "startOffset": 0,
        "endOffset": 0,
        "x": 850,
        "y": 660,
        "wires": [
            [
                "100c1cb7.820a43"
            ],
            [
                "7f74d9fe.189ad8"
            ]
        ]
    },
    {
        "id": "100c1cb7.820a43",
        "type": "api-call-service",
        "z": "62ce34cf.a7671c",
        "name": "Turn on light (dim)",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "light",
        "service": "turn_on",
        "entityId": "group.upstairs_hallway",
        "data": "{\"brightness\":1}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 1070,
        "y": 620,
        "wires": [
            [
                "d9ab294f.c1d178"
            ]
        ]
    },
    {
        "id": "bacb1514.190848",
        "type": "comment",
        "z": "bf163cd5.f84c",
        "name": "Samsung button event codes",
        "info": "### Samsung button events\n - 1001: Long press\n - 1002: Single press\n - 1004: Double press",
        "x": 360,
        "y": 280,
        "wires": []
    },
    {
        "id": "685a42b7.cb068c",
        "type": "comment",
        "z": "4c3e78a1.ebb138",
        "name": "Samsung button event codes",
        "info": "### Samsung button events\n - 1001: Long press\n - 1002: Single press\n - 1004: Double press",
        "x": 340,
        "y": 320,
        "wires": []
    },
    {
        "id": "f42dda3.af91b28",
        "type": "comment",
        "z": "7b5378f9.154968",
        "name": "Samsung button event codes",
        "info": "### Samsung button events\n - 1001: Long press\n - 1002: Single press\n - 1004: Double press",
        "x": 340,
        "y": 300,
        "wires": []
    },
    {
        "id": "71b10af6.310b44",
        "type": "server-state-changed",
        "z": "e9868773.797078",
        "name": "Foyer Motion Event",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "binary_sensor.multi_sensor_st_front_door_openclose",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "",
        "halt_if_type": "jsonata",
        "halt_if_compare": "is",
        "outputs": 1,
        "output_only_on_state_change": true,
        "x": 90,
        "y": 560,
        "wires": [
            [
                "ed05a9af.2d13e8"
            ]
        ]
    },
    {
        "id": "ed05a9af.2d13e8",
        "type": "switch",
        "z": "e9868773.797078",
        "name": "Motion On or Off?",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "on",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "off",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 130,
        "y": 740,
        "wires": [
            [
                "a9c95ae4.58e688",
                "173f58f.68101a7"
            ],
            [
                "564a61f6.d4c24",
                "330b6021.6dbe9"
            ]
        ]
    },
    {
        "id": "9bbf440e.7b9318",
        "type": "api-current-state",
        "z": "e9868773.797078",
        "name": "Light not on yet?",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "outputs": 2,
        "halt_if": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is_not",
        "override_topic": false,
        "entity_id": "light.outside_front",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 610,
        "y": 660,
        "wires": [
            [
                "8d820114.af30f",
                "f5496d07.f22e4"
            ],
            []
        ]
    },
    {
        "id": "f5496d07.f22e4",
        "type": "api-call-service",
        "z": "e9868773.797078",
        "name": "Turn on light",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "light",
        "service": "turn_on",
        "entityId": "light.outside_front",
        "data": "{\"brightness_pct\":100}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 890,
        "y": 680,
        "wires": [
            [
                "e259cd14.39ed5"
            ]
        ]
    },
    {
        "id": "188eb2ed.d8ca8d",
        "type": "change",
        "z": "e9868773.797078",
        "name": "Stop timer msg",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "stop",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 500,
        "y": 780,
        "wires": [
            [
                "2741eb95.e54344"
            ]
        ]
    },
    {
        "id": "2741eb95.e54344",
        "type": "stoptimer",
        "z": "e9868773.797078",
        "duration": "5",
        "units": "Minute",
        "payloadtype": "num",
        "payloadval": "0",
        "name": "",
        "x": 660,
        "y": 860,
        "wires": [
            [
                "20ddb03f.050fa",
                "c19e807c.79ea8"
            ],
            []
        ]
    },
    {
        "id": "20ddb03f.050fa",
        "type": "api-call-service",
        "z": "e9868773.797078",
        "name": "Turn off light",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "light",
        "service": "turn_off",
        "entityId": "light.outside_front",
        "data": "",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 890,
        "y": 860,
        "wires": [
            [
                "e259cd14.39ed5"
            ]
        ]
    },
    {
        "id": "8d820114.af30f",
        "type": "change",
        "z": "e9868773.797078",
        "name": "Mark light on by motion",
        "rules": [
            {
                "t": "set",
                "p": "did_turn_light_on",
                "pt": "flow",
                "to": "true",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 930,
        "y": 620,
        "wires": [
            []
        ]
    },
    {
        "id": "564a61f6.d4c24",
        "type": "switch",
        "z": "e9868773.797078",
        "name": "Is on from open/close?",
        "property": "did_turn_light_on",
        "propertyType": "flow",
        "rules": [
            {
                "t": "true"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 380,
        "y": 860,
        "wires": [
            [
                "2741eb95.e54344"
            ]
        ]
    },
    {
        "id": "a9c95ae4.58e688",
        "type": "api-current-state",
        "z": "e9868773.797078",
        "name": "Is dark?",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "outputs": 2,
        "halt_if": "below_horizon",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "sun.sun",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 340,
        "y": 700,
        "wires": [
            [
                "9bbf440e.7b9318",
                "188eb2ed.d8ca8d",
                "f86bebf4.644dc8"
            ],
            []
        ]
    },
    {
        "id": "c19e807c.79ea8",
        "type": "change",
        "z": "e9868773.797078",
        "name": "Clear light on by motion or user",
        "rules": [
            {
                "t": "set",
                "p": "did_turn_light_on",
                "pt": "flow",
                "to": "false",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 970,
        "y": 940,
        "wires": [
            []
        ]
    },
    {
        "id": "e259cd14.39ed5",
        "type": "api-call-service",
        "z": "e9868773.797078",
        "name": "Log execution to HA logbook",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "logbook",
        "service": "log",
        "entityId": "",
        "data": "{\"name\":\"node-red\",\"message\":\"Front Door Entry/Exit flow executed successfully.\",\"domain\":\"automation\"}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 1160,
        "y": 780,
        "wires": [
            []
        ]
    },
    {
        "id": "41ce2ec4.d116b",
        "type": "server-state-changed",
        "z": "e9868773.797078",
        "name": "Was light turned off by this or user?",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "light.outside_front",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "off",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 620,
        "y": 980,
        "wires": [
            [
                "c19e807c.79ea8"
            ],
            []
        ]
    },
    {
        "id": "972b9388.f671a",
        "type": "server-state-changed",
        "z": "884319a9.e92148",
        "name": "Foyer Motion Event",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "binary_sensor.multi_sensor_st_kitchen_door_openclose",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "",
        "halt_if_type": "jsonata",
        "halt_if_compare": "is",
        "outputs": 1,
        "output_only_on_state_change": true,
        "x": 90,
        "y": 600,
        "wires": [
            [
                "210c5d3b.b91672"
            ]
        ]
    },
    {
        "id": "210c5d3b.b91672",
        "type": "switch",
        "z": "884319a9.e92148",
        "name": "Motion On or Off?",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "on",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "off",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 130,
        "y": 780,
        "wires": [
            [
                "b49bc2c6.fad6d",
                "596d5487.fcaf4c"
            ],
            [
                "7ec47fa6.5f3d9"
            ]
        ]
    },
    {
        "id": "70032b8c.d97914",
        "type": "api-current-state",
        "z": "884319a9.e92148",
        "name": "Light not on yet?",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "outputs": 2,
        "halt_if": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is_not",
        "override_topic": false,
        "entity_id": "light.outside_kitchen",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 610,
        "y": 700,
        "wires": [
            [
                "a9086fd2.b11ff",
                "fd751f58.f70dc"
            ],
            []
        ]
    },
    {
        "id": "fd751f58.f70dc",
        "type": "api-call-service",
        "z": "884319a9.e92148",
        "name": "Turn on light",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "light",
        "service": "turn_on",
        "entityId": "light.outside_kitchen",
        "data": "{\"brightness_pct\":100}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 890,
        "y": 720,
        "wires": [
            [
                "9dcd21d6.76638"
            ]
        ]
    },
    {
        "id": "e3887ade.188898",
        "type": "change",
        "z": "884319a9.e92148",
        "name": "Stop timer msg",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "stop",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 500,
        "y": 820,
        "wires": [
            [
                "45061cb8.b1e6c4"
            ]
        ]
    },
    {
        "id": "45061cb8.b1e6c4",
        "type": "stoptimer",
        "z": "884319a9.e92148",
        "duration": "5",
        "units": "Minute",
        "payloadtype": "num",
        "payloadval": "0",
        "name": "",
        "x": 660,
        "y": 900,
        "wires": [
            [
                "5234748.55c1a8c",
                "c25cc010.43d42"
            ],
            []
        ]
    },
    {
        "id": "5234748.55c1a8c",
        "type": "api-call-service",
        "z": "884319a9.e92148",
        "name": "Turn off light",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "light",
        "service": "turn_off",
        "entityId": "light.outside_kitchen",
        "data": "",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 890,
        "y": 900,
        "wires": [
            [
                "9dcd21d6.76638"
            ]
        ]
    },
    {
        "id": "a9086fd2.b11ff",
        "type": "change",
        "z": "884319a9.e92148",
        "name": "Mark light on by motion",
        "rules": [
            {
                "t": "set",
                "p": "did_turn_light_on",
                "pt": "flow",
                "to": "true",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 930,
        "y": 660,
        "wires": [
            []
        ]
    },
    {
        "id": "7ec47fa6.5f3d9",
        "type": "switch",
        "z": "884319a9.e92148",
        "name": "Is on from open/close?",
        "property": "did_turn_light_on",
        "propertyType": "flow",
        "rules": [
            {
                "t": "true"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 260,
        "y": 840,
        "wires": [
            [
                "16446335.cbdf7d"
            ]
        ]
    },
    {
        "id": "b49bc2c6.fad6d",
        "type": "api-current-state",
        "z": "884319a9.e92148",
        "name": "Is dark?",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "outputs": 2,
        "halt_if": "below_horizon",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "sun.sun",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 340,
        "y": 740,
        "wires": [
            [
                "70032b8c.d97914",
                "e3887ade.188898"
            ],
            []
        ]
    },
    {
        "id": "c25cc010.43d42",
        "type": "change",
        "z": "884319a9.e92148",
        "name": "Clear light on by motion or user",
        "rules": [
            {
                "t": "set",
                "p": "did_turn_light_on",
                "pt": "flow",
                "to": "false",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 970,
        "y": 980,
        "wires": [
            []
        ]
    },
    {
        "id": "9dcd21d6.76638",
        "type": "api-call-service",
        "z": "884319a9.e92148",
        "name": "Log execution to HA logbook",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "logbook",
        "service": "log",
        "entityId": "",
        "data": "{\"name\":\"node-red\",\"message\":\"Kitchen Door Entry/Exit flow executed successfully.\",\"domain\":\"automation\"}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 1160,
        "y": 820,
        "wires": [
            []
        ]
    },
    {
        "id": "77fda051.60df5",
        "type": "server-state-changed",
        "z": "884319a9.e92148",
        "name": "Was light turned off by this or user?",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "light.outside_kitchen",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "off",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 620,
        "y": 1060,
        "wires": [
            [
                "c25cc010.43d42"
            ],
            []
        ]
    },
    {
        "id": "f86bebf4.644dc8",
        "type": "link out",
        "z": "e9868773.797078",
        "name": "Out: Front Door Open After Dark Triggered",
        "links": [
            "efb9ed8a.2ea77"
        ],
        "x": 555,
        "y": 580,
        "wires": []
    },
    {
        "id": "efb9ed8a.2ea77",
        "type": "link in",
        "z": "884319a9.e92148",
        "name": "In: Front Door Open After Dark Triggered",
        "links": [
            "f86bebf4.644dc8"
        ],
        "x": 435,
        "y": 620,
        "wires": [
            [
                "70032b8c.d97914",
                "e3887ade.188898"
            ]
        ]
    },
    {
        "id": "16446335.cbdf7d",
        "type": "api-current-state",
        "z": "884319a9.e92148",
        "name": "Is front door closed?",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "outputs": 2,
        "halt_if": "off",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "binary_sensor.multi_sensor_st_front_door_openclose",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 400,
        "y": 900,
        "wires": [
            [
                "db2d66d0.bc1d68"
            ],
            []
        ]
    },
    {
        "id": "db2d66d0.bc1d68",
        "type": "api-current-state",
        "z": "884319a9.e92148",
        "name": "Is kitchen door closed?",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "outputs": 2,
        "halt_if": "off",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "binary_sensor.multi_sensor_st_kitchen_door_openclose",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 440,
        "y": 960,
        "wires": [
            [
                "45061cb8.b1e6c4"
            ],
            []
        ]
    },
    {
        "id": "330b6021.6dbe9",
        "type": "link out",
        "z": "e9868773.797078",
        "name": "Out: Front Door Closed Triggered",
        "links": [
            "944af35a.97916"
        ],
        "x": 295,
        "y": 940,
        "wires": []
    },
    {
        "id": "944af35a.97916",
        "type": "link in",
        "z": "884319a9.e92148",
        "name": "In: Front Door Closed Triggered",
        "links": [
            "330b6021.6dbe9"
        ],
        "x": 115,
        "y": 940,
        "wires": [
            [
                "7ec47fa6.5f3d9"
            ]
        ]
    },
    {
        "id": "91df9e5d.73c7c",
        "type": "server-state-changed",
        "z": "35ab222c.a6eb9e",
        "name": "Foyer Motion Event",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "binary_sensor.motion_sensor_eco_downstairs_hallway",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "",
        "halt_if_type": "jsonata",
        "halt_if_compare": "is",
        "outputs": 1,
        "output_only_on_state_change": true,
        "x": 90,
        "y": 600,
        "wires": [
            [
                "19a3e8f6.8fed97"
            ]
        ]
    },
    {
        "id": "19a3e8f6.8fed97",
        "type": "switch",
        "z": "35ab222c.a6eb9e",
        "name": "Motion On or Off?",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "on",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "off",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 130,
        "y": 740,
        "wires": [
            [
                "4afa2ec9.d218",
                "6108431a.4459bc"
            ],
            [
                "1ae52074.bfe95"
            ]
        ]
    },
    {
        "id": "ec7a30c8.1f8a8",
        "type": "api-current-state",
        "z": "35ab222c.a6eb9e",
        "name": "Light not on yet?",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "outputs": 2,
        "halt_if": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is_not",
        "override_topic": false,
        "entity_id": "group.downstairs_hallway",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 610,
        "y": 660,
        "wires": [
            [
                "349190a0.746a8",
                "c5646bb.48f7798"
            ],
            []
        ]
    },
    {
        "id": "8e2ed4f8.60bd58",
        "type": "api-call-service",
        "z": "35ab222c.a6eb9e",
        "name": "Turn on light (max)",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "light",
        "service": "turn_on",
        "entityId": "group.downstairs_hallway",
        "data": "{\"brightness_pct\":100}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 1070,
        "y": 760,
        "wires": [
            [
                "6f413a4d.18e804"
            ]
        ]
    },
    {
        "id": "54f9b66e.05ccf8",
        "type": "change",
        "z": "35ab222c.a6eb9e",
        "name": "Stop timer msg",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "stop",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 500,
        "y": 780,
        "wires": [
            [
                "6cdc156c.a958fc"
            ]
        ]
    },
    {
        "id": "6cdc156c.a958fc",
        "type": "stoptimer",
        "z": "35ab222c.a6eb9e",
        "duration": "2",
        "units": "Minute",
        "payloadtype": "num",
        "payloadval": "0",
        "name": "",
        "x": 660,
        "y": 860,
        "wires": [
            [
                "1799c660.6158da",
                "3ff24a8.bc04db6"
            ],
            []
        ]
    },
    {
        "id": "1799c660.6158da",
        "type": "api-call-service",
        "z": "35ab222c.a6eb9e",
        "name": "Turn off light",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "light",
        "service": "turn_off",
        "entityId": "group.downstairs_hallway",
        "data": "",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 1030,
        "y": 880,
        "wires": [
            [
                "6f413a4d.18e804"
            ]
        ]
    },
    {
        "id": "349190a0.746a8",
        "type": "change",
        "z": "35ab222c.a6eb9e",
        "name": "Mark light on by motion",
        "rules": [
            {
                "t": "set",
                "p": "did_turn_light_on",
                "pt": "flow",
                "to": "true",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 930,
        "y": 620,
        "wires": [
            []
        ]
    },
    {
        "id": "1ae52074.bfe95",
        "type": "switch",
        "z": "35ab222c.a6eb9e",
        "name": "Is on from motion?",
        "property": "did_turn_light_on",
        "propertyType": "flow",
        "rules": [
            {
                "t": "true"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 370,
        "y": 860,
        "wires": [
            [
                "6cdc156c.a958fc"
            ]
        ]
    },
    {
        "id": "4afa2ec9.d218",
        "type": "api-current-state",
        "z": "35ab222c.a6eb9e",
        "name": "Is dark?",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "outputs": 2,
        "halt_if": "below_horizon",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "sun.sun",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 340,
        "y": 700,
        "wires": [
            [
                "ec7a30c8.1f8a8",
                "54f9b66e.05ccf8"
            ],
            []
        ]
    },
    {
        "id": "3ff24a8.bc04db6",
        "type": "change",
        "z": "35ab222c.a6eb9e",
        "name": "Clear light on by motion or user",
        "rules": [
            {
                "t": "set",
                "p": "did_turn_light_on",
                "pt": "flow",
                "to": "false",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 970,
        "y": 940,
        "wires": [
            []
        ]
    },
    {
        "id": "6f413a4d.18e804",
        "type": "api-call-service",
        "z": "35ab222c.a6eb9e",
        "name": "Log execution to HA logbook",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "logbook",
        "service": "log",
        "entityId": "",
        "data": "{\"name\":\"node-red\",\"message\":\"Downstairs Hallway Motion flow executed successfully.\",\"domain\":\"automation\"}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 1380,
        "y": 800,
        "wires": [
            []
        ]
    },
    {
        "id": "3e3df2a5.c9761e",
        "type": "server-state-changed",
        "z": "35ab222c.a6eb9e",
        "name": "Was light turned off by this or user?",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "group.downstairs_hallway",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "off",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 620,
        "y": 980,
        "wires": [
            [
                "3ff24a8.bc04db6"
            ],
            []
        ]
    },
    {
        "id": "c5646bb.48f7798",
        "type": "time-range-switch",
        "z": "35ab222c.a6eb9e",
        "name": "Is night-light time?",
        "lat": "",
        "lon": "",
        "startTime": "21:00",
        "endTime": "05:00",
        "startOffset": 0,
        "endOffset": 0,
        "x": 850,
        "y": 720,
        "wires": [
            [
                "8b6e9372.7f0e2"
            ],
            [
                "8e2ed4f8.60bd58"
            ]
        ]
    },
    {
        "id": "8b6e9372.7f0e2",
        "type": "api-call-service",
        "z": "35ab222c.a6eb9e",
        "name": "Turn on light (dim)",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "light",
        "service": "turn_on",
        "entityId": "group.downstairs_hallway",
        "data": "{\"brightness\":1}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 1070,
        "y": 680,
        "wires": [
            [
                "6f413a4d.18e804"
            ]
        ]
    },
    {
        "id": "b6d92969.1e42f8",
        "type": "server-state-changed",
        "z": "390fc521.dffd0a",
        "name": "JC's Plex on Shield (MrMC) changed",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "media_player.plex_jc_shield_mrmc",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 1,
        "output_only_on_state_change": true,
        "x": 240,
        "y": 340,
        "wires": [
            [
                "86d81007.82813"
            ]
        ]
    },
    {
        "id": "95214922.2b0cf8",
        "type": "server-state-changed",
        "z": "390fc521.dffd0a",
        "name": "JC's Plex on Shield (Plex) changed",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "media_player.plex_jc_shield_plex",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 1,
        "output_only_on_state_change": true,
        "x": 240,
        "y": 420,
        "wires": [
            [
                "86d81007.82813"
            ]
        ]
    },
    {
        "id": "86d81007.82813",
        "type": "switch",
        "z": "390fc521.dffd0a",
        "name": "New play/pause state?",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "playing",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "paused",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 520,
        "y": 380,
        "wires": [
            [
                "7d8308dc.e52bb8",
                "1b9c8db9.b485c2"
            ],
            [
                "bca4e90.5a43f18"
            ]
        ]
    },
    {
        "id": "818717c2.dbe6e8",
        "type": "api-call-service",
        "z": "390fc521.dffd0a",
        "name": "Turn off non-living room lights",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "light",
        "service": "turn_off",
        "entityId": "group.all_lights_except_living_room",
        "data": "",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 1050,
        "y": 360,
        "wires": [
            [
                "adc3ea04.4a0798"
            ]
        ]
    },
    {
        "id": "adc3ea04.4a0798",
        "type": "api-call-service",
        "z": "390fc521.dffd0a",
        "name": "Log execution to HA logbook",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "logbook",
        "service": "log",
        "entityId": "",
        "data": "{\"name\":\"node-red\",\"message\":\"Living Room Media flow executed successfully.\",\"domain\":\"automation\"}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 1400,
        "y": 360,
        "wires": [
            []
        ]
    },
    {
        "id": "904c234f.3223e",
        "type": "api-current-state",
        "z": "390fc521.dffd0a",
        "name": "Light not on yet?",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "outputs": 2,
        "halt_if": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is_not",
        "override_topic": false,
        "entity_id": "group.living_room",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 770,
        "y": 540,
        "wires": [
            [
                "8807a907.455148",
                "35b24348.f405bc"
            ],
            []
        ]
    },
    {
        "id": "8807a907.455148",
        "type": "change",
        "z": "390fc521.dffd0a",
        "name": "Mark light on by pause",
        "rules": [
            {
                "t": "set",
                "p": "did_turn_light_on",
                "pt": "flow",
                "to": "true",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1040,
        "y": 580,
        "wires": [
            []
        ]
    },
    {
        "id": "bca4e90.5a43f18",
        "type": "api-current-state",
        "z": "390fc521.dffd0a",
        "name": "Is dark?",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "outputs": 2,
        "halt_if": "below_horizon",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "sun.sun",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 720,
        "y": 440,
        "wires": [
            [
                "904c234f.3223e"
            ],
            []
        ]
    },
    {
        "id": "1ada85ab.c1fa2a",
        "type": "change",
        "z": "390fc521.dffd0a",
        "name": "Clear light on by pause or user",
        "rules": [
            {
                "t": "set",
                "p": "did_turn_light_on",
                "pt": "flow",
                "to": "false",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1290,
        "y": 220,
        "wires": [
            []
        ]
    },
    {
        "id": "4f29d4bd.23044c",
        "type": "server-state-changed",
        "z": "390fc521.dffd0a",
        "name": "Was light turned off by this or user?",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "group.living_room",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "off",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 980,
        "y": 180,
        "wires": [
            [
                "1ada85ab.c1fa2a"
            ],
            []
        ]
    },
    {
        "id": "35b24348.f405bc",
        "type": "api-call-service",
        "z": "390fc521.dffd0a",
        "name": "Turn on light (dim)",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "light",
        "service": "turn_on",
        "entityId": "group.living_room",
        "data": "{\"brightness\":1}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 1030,
        "y": 480,
        "wires": [
            [
                "adc3ea04.4a0798"
            ]
        ]
    },
    {
        "id": "7d8308dc.e52bb8",
        "type": "switch",
        "z": "390fc521.dffd0a",
        "name": "Is on from pause?",
        "property": "did_turn_light_on",
        "propertyType": "flow",
        "rules": [
            {
                "t": "true"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 770,
        "y": 280,
        "wires": [
            [
                "5a0ce2de.6ff3cc"
            ]
        ]
    },
    {
        "id": "5a0ce2de.6ff3cc",
        "type": "api-call-service",
        "z": "390fc521.dffd0a",
        "name": "Turn off living room lights",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "light",
        "service": "turn_off",
        "entityId": "group.living_room",
        "data": "",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 1010,
        "y": 280,
        "wires": [
            [
                "1ada85ab.c1fa2a",
                "adc3ea04.4a0798"
            ]
        ]
    },
    {
        "id": "1b9c8db9.b485c2",
        "type": "api-current-state",
        "z": "390fc521.dffd0a",
        "name": "Single occupant?",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "outputs": 2,
        "halt_if": "true",
        "halt_if_type": "bool",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "input_boolean.single_occupant",
        "state_type": "habool",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 770,
        "y": 360,
        "wires": [
            [
                "818717c2.dbe6e8"
            ],
            []
        ]
    },
    {
        "id": "d8b81ae0.0bc7a8",
        "type": "server-state-changed",
        "z": "3aefc8fa.f61958",
        "name": "Flagged to relinquish to motion?",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "input_boolean.pending_relinquish_to_motion",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "habool",
        "haltifstate": "true",
        "halt_if_type": "bool",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 250,
        "y": 340,
        "wires": [
            [
                "a61fab4f.a57358",
                "2d335beb.472f24"
            ],
            []
        ]
    },
    {
        "id": "a61fab4f.a57358",
        "type": "api-call-service",
        "z": "3aefc8fa.f61958",
        "name": "Cleared relinquish to motion flag",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "input_boolean",
        "service": "turn_off",
        "entityId": "input_boolean.pending_relinquish_to_motion",
        "data": "",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 570,
        "y": 340,
        "wires": [
            [
                "4b58f2c7.24c89c"
            ]
        ]
    },
    {
        "id": "4b58f2c7.24c89c",
        "type": "api-call-service",
        "z": "3aefc8fa.f61958",
        "name": "Log execution to HA logbook",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "logbook",
        "service": "log",
        "entityId": "",
        "data": "{\"name\":\"node-red\",\"message\":\"Relinquish to Motion flow executed successfully.\",\"domain\":\"automation\"}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 880,
        "y": 340,
        "wires": [
            []
        ]
    },
    {
        "id": "2d335beb.472f24",
        "type": "link out",
        "z": "3aefc8fa.f61958",
        "name": "Out: Relinquish to Motion Triggered",
        "links": [
            "7f8b4961.f338b8",
            "353a3d0e.03da72",
            "973aca54.e38288",
            "864ed584.5c4428",
            "f09dd37f.d3265"
        ],
        "x": 475,
        "y": 220,
        "wires": []
    },
    {
        "id": "7f8b4961.f338b8",
        "type": "link in",
        "z": "1d296556.09592b",
        "name": "In: Relinquish to Motion Triggered",
        "links": [
            "2d335beb.472f24"
        ],
        "x": 475,
        "y": 420,
        "wires": [
            [
                "a73637f4.3f6a78"
            ]
        ]
    },
    {
        "id": "a73637f4.3f6a78",
        "type": "api-current-state",
        "z": "1d296556.09592b",
        "name": "Light already on?",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "outputs": 2,
        "halt_if": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "light.foyer",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 630,
        "y": 420,
        "wires": [
            [
                "442100ee.26b29"
            ],
            []
        ]
    },
    {
        "id": "353a3d0e.03da72",
        "type": "link in",
        "z": "62ce34cf.a7671c",
        "name": "In: Relinquish to Motion Triggered",
        "links": [
            "2d335beb.472f24"
        ],
        "x": 455,
        "y": 520,
        "wires": [
            [
                "d8c66ca7.f0a49"
            ]
        ]
    },
    {
        "id": "d8c66ca7.f0a49",
        "type": "api-current-state",
        "z": "62ce34cf.a7671c",
        "name": "Light already on?",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "outputs": 2,
        "halt_if": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "group.upstairs_hallway",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 610,
        "y": 520,
        "wires": [
            [
                "dd8ba79c.bea668"
            ],
            []
        ]
    },
    {
        "id": "973aca54.e38288",
        "type": "link in",
        "z": "35ab222c.a6eb9e",
        "name": "In: Relinquish to Motion Triggered",
        "links": [
            "2d335beb.472f24"
        ],
        "x": 455,
        "y": 580,
        "wires": [
            [
                "fdc477b1.2f4c28"
            ]
        ]
    },
    {
        "id": "fdc477b1.2f4c28",
        "type": "api-current-state",
        "z": "35ab222c.a6eb9e",
        "name": "Light already on?",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "outputs": 2,
        "halt_if": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "group.downstairs_hallway",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 610,
        "y": 580,
        "wires": [
            [
                "349190a0.746a8"
            ],
            []
        ]
    },
    {
        "id": "864ed584.5c4428",
        "type": "link in",
        "z": "e9868773.797078",
        "name": "In: Relinquish to Motion Triggered",
        "links": [
            "2d335beb.472f24"
        ],
        "x": 455,
        "y": 520,
        "wires": [
            [
                "d060b09f.a0a13"
            ]
        ]
    },
    {
        "id": "d060b09f.a0a13",
        "type": "api-current-state",
        "z": "e9868773.797078",
        "name": "Light already on?",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "outputs": 2,
        "halt_if": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "light.outside_front",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 610,
        "y": 520,
        "wires": [
            [
                "8d820114.af30f"
            ],
            []
        ]
    },
    {
        "id": "f09dd37f.d3265",
        "type": "link in",
        "z": "884319a9.e92148",
        "name": "In: Relinquish to Motion Triggered",
        "links": [
            "2d335beb.472f24"
        ],
        "x": 435,
        "y": 560,
        "wires": [
            [
                "26c8be2e.7537e2"
            ]
        ]
    },
    {
        "id": "26c8be2e.7537e2",
        "type": "api-current-state",
        "z": "884319a9.e92148",
        "name": "Light already on?",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "outputs": 2,
        "halt_if": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "light.outside_kitchen",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 610,
        "y": 560,
        "wires": [
            [
                "a9086fd2.b11ff"
            ],
            []
        ]
    },
    {
        "id": "1e3cfe7.c8f8702",
        "type": "switch",
        "z": "1d296556.09592b",
        "name": "Is on from motion?",
        "property": "did_turn_light_on",
        "propertyType": "flow",
        "rules": [
            {
                "t": "true"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 370,
        "y": 480,
        "wires": [
            [
                "d2caa878.c990f8",
                "7c5a2e5c.bd53"
            ]
        ]
    },
    {
        "id": "e2377e7b.8d444",
        "type": "switch",
        "z": "62ce34cf.a7671c",
        "name": "Is on from motion?",
        "property": "did_turn_light_on",
        "propertyType": "flow",
        "rules": [
            {
                "t": "true"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 350,
        "y": 580,
        "wires": [
            [
                "ba91b17f.0c531",
                "7a861800.e44a98"
            ]
        ]
    },
    {
        "id": "6108431a.4459bc",
        "type": "switch",
        "z": "35ab222c.a6eb9e",
        "name": "Is on from motion?",
        "property": "did_turn_light_on",
        "propertyType": "flow",
        "rules": [
            {
                "t": "true"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 350,
        "y": 640,
        "wires": [
            [
                "54f9b66e.05ccf8",
                "ec7a30c8.1f8a8"
            ]
        ]
    },
    {
        "id": "173f58f.68101a7",
        "type": "switch",
        "z": "e9868773.797078",
        "name": "Is on from open/close?",
        "property": "did_turn_light_on",
        "propertyType": "flow",
        "rules": [
            {
                "t": "true"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 320,
        "y": 640,
        "wires": [
            [
                "f86bebf4.644dc8",
                "9bbf440e.7b9318",
                "188eb2ed.d8ca8d"
            ]
        ]
    },
    {
        "id": "596d5487.fcaf4c",
        "type": "switch",
        "z": "884319a9.e92148",
        "name": "Is on from open/close?",
        "property": "did_turn_light_on",
        "propertyType": "flow",
        "rules": [
            {
                "t": "true"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 320,
        "y": 680,
        "wires": [
            [
                "70032b8c.d97914",
                "e3887ade.188898"
            ]
        ]
    },
    {
        "id": "d513b5b1.6f0e18",
        "type": "server-state-changed",
        "z": "c35af4f2.4cd108",
        "name": "Phone arrived home",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "device_tracker.sm_n970u",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "home",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 350,
        "y": 520,
        "wires": [
            [
                "229f2e70.a0b3a2",
                "17d225c7.3c968a"
            ],
            []
        ]
    },
    {
        "id": "229f2e70.a0b3a2",
        "type": "api-call-service",
        "z": "c35af4f2.4cd108",
        "name": "Log execution to HA logbook",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "logbook",
        "service": "log",
        "entityId": "",
        "data": "{\"name\":\"node-red\",\"message\":\"Phone Location flow executed successfully.\",\"domain\":\"automation\"}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 640,
        "y": 520,
        "wires": [
            []
        ]
    },
    {
        "id": "17d225c7.3c968a",
        "type": "link out",
        "z": "c35af4f2.4cd108",
        "name": "Out: Phone Arrived Home",
        "links": [
            "c578334b.d5d9d"
        ],
        "x": 535,
        "y": 460,
        "wires": []
    },
    {
        "id": "c578334b.d5d9d",
        "type": "link in",
        "z": "e9868773.797078",
        "name": "In: Phone Arrived Home",
        "links": [
            "17d225c7.3c968a"
        ],
        "x": 295,
        "y": 780,
        "wires": [
            [
                "a9c95ae4.58e688"
            ]
        ]
    },
    {
        "id": "b1738366.76173",
        "type": "server-state-changed",
        "z": "66eaa4d8.773f4c",
        "name": "Flagged to skip next on yamaha?",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "input_boolean.pending_yamaha_skip_next",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "habool",
        "haltifstate": "true",
        "halt_if_type": "bool",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 130,
        "y": 440,
        "wires": [
            [
                "d9200866.dead68",
                "fe35a553.2f2e68"
            ],
            []
        ]
    },
    {
        "id": "d9200866.dead68",
        "type": "api-current-state",
        "z": "66eaa4d8.773f4c",
        "name": "Is yamaha on?",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "outputs": 2,
        "halt_if": "off",
        "halt_if_type": "str",
        "halt_if_compare": "is_not",
        "override_topic": false,
        "entity_id": "media_player.yamaha_receiver",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 400,
        "y": 400,
        "wires": [
            [
                "15ab89b5.405906"
            ],
            []
        ]
    },
    {
        "id": "15ab89b5.405906",
        "type": "api-call-service",
        "z": "66eaa4d8.773f4c",
        "name": "Skip to next",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "media_player",
        "service": "media_next_track",
        "entityId": "media_player.yamaha_receiver",
        "data": "",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 620,
        "y": 400,
        "wires": [
            []
        ]
    },
    {
        "id": "fe35a553.2f2e68",
        "type": "api-call-service",
        "z": "66eaa4d8.773f4c",
        "name": "Clear skip next on yamaha flag",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "input_boolean",
        "service": "turn_off",
        "entityId": "input_boolean.pending_yamaha_skip_next",
        "data": "",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 450,
        "y": 460,
        "wires": [
            [
                "2033d86b.f74768"
            ]
        ]
    },
    {
        "id": "2033d86b.f74768",
        "type": "api-call-service",
        "z": "66eaa4d8.773f4c",
        "name": "Log execution to HA logbook",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "logbook",
        "service": "log",
        "entityId": "",
        "data": "{\"name\":\"node-red\",\"message\":\"Skip Next on Yamaha flow executed successfully.\",\"domain\":\"automation\"}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 760,
        "y": 460,
        "wires": [
            []
        ]
    },
    {
        "id": "d0eb5b.db1924a8",
        "type": "server-state-changed",
        "z": "bec3a76b.4b57e8",
        "name": "Car/House alarm triggered or cleared?",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "group.triggered_alarms",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 190,
        "y": 80,
        "wires": [
            [
                "4f8f2463.0a2c5c"
            ],
            [
                "5688115f.ef31e"
            ]
        ]
    },
    {
        "id": "5737f738.e691a8",
        "type": "api-call-service",
        "z": "bec3a76b.4b57e8",
        "name": "Flash all lights red",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "light",
        "service": "turn_on",
        "entityId": "group.functional_lights",
        "data": "{\"brightness_pct\":100,\"color_name\":\"red\",\"flash\":\"long\"}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 490,
        "y": 660,
        "wires": [
            [
                "f37025ee.c53498"
            ]
        ]
    },
    {
        "id": "f37025ee.c53498",
        "type": "delay",
        "z": "bec3a76b.4b57e8",
        "name": "Wait to retrigger flash",
        "pauseType": "delay",
        "timeout": "15",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 720,
        "y": 660,
        "wires": [
            [
                "85279ec5.18371"
            ]
        ],
        "info": "Hue flash sometimes times out it seems, so need to keep sending..."
    },
    {
        "id": "85279ec5.18371",
        "type": "api-current-state",
        "z": "bec3a76b.4b57e8",
        "name": "Is still triggered?",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "outputs": 2,
        "halt_if": "Alert active",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "input_select.alarm_alert",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 940,
        "y": 660,
        "wires": [
            [
                "5737f738.e691a8"
            ],
            []
        ]
    },
    {
        "id": "86b2e7e1.bb7a38",
        "type": "ha-get-entities",
        "z": "bec3a76b.4b57e8",
        "server": "2f5bd1e0.67e40e",
        "name": "Get individual light states",
        "rules": [
            {
                "property": "",
                "logic": "jsonata",
                "value": "$exists($entity().attributes.is_hue_group) = false",
                "valueType": "jsonata"
            },
            {
                "property": "entity_id",
                "logic": "starts_with",
                "value": "light.",
                "valueType": "str"
            }
        ],
        "output_type": "array",
        "output_empty_results": false,
        "output_location_type": "msg",
        "output_location": "payload",
        "output_results_count": 1,
        "x": 710,
        "y": 540,
        "wires": [
            [
                "5046f986.924c18"
            ]
        ],
        "info": "This filters out hue groups since lights within a group may have different settings (which it looks like Hue just \"averages\" the settings to report a single number set for all of the lights)."
    },
    {
        "id": "2b1bd952.12eef6",
        "type": "ha-get-entities",
        "z": "5a3565e2.10464c",
        "server": "2f5bd1e0.67e40e",
        "name": "Get States",
        "rules": [
            {
                "property": "entity_id",
                "logic": "is",
                "value": "^(light|switch|climate)\\.+",
                "valueType": "re"
            }
        ],
        "output_type": "array",
        "output_empty_results": false,
        "output_location_type": "msg",
        "output_location": "payload",
        "output_results_count": 1,
        "x": 310,
        "y": 480,
        "wires": [
            [
                "98779eef.54d09"
            ]
        ]
    },
    {
        "id": "11998cc2.5c7843",
        "type": "inject",
        "z": "5a3565e2.10464c",
        "name": "Store states",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 134,
        "y": 480,
        "wires": [
            [
                "2b1bd952.12eef6"
            ]
        ]
    },
    {
        "id": "fe98c188.3679f",
        "type": "comment",
        "z": "5a3565e2.10464c",
        "name": "How Kermit would do store states",
        "info": "https://community.home-assistant.io/t/example-saving-and-restoring-states/99061",
        "x": 178,
        "y": 432,
        "wires": []
    },
    {
        "id": "98779eef.54d09",
        "type": "function",
        "z": "5a3565e2.10464c",
        "name": "transform data",
        "func": "const entities = msg.payload.map((e) => {\n    const domain = e.entity_id.split('.')[0];\n    const payload = {};\n\n    switch(domain) {\n        case 'switch':\n            payload.domain = domain;\n            payload.service = `turn_${e.state}`;\n            payload.data = {\n                entity_id: e.entity_id,\n            }\n            break;\n         case 'light':\n            payload.domain = domain;\n            payload.service = `turn_${e.state}`;\n            payload.data = {\n                entity_id: e.entity_id,\n                brightness: e.attributes.brightness,\n                color_temp: e.attributes.color_temp,\n                xy_color: e.attributes.xy_color,\n            };    \n            break;\n        case 'climate':\n            payload.domain = 'climate';\n            payload.service = `set_temperature`;\n            payload.data = {\n                entity_id: e.entity_id,\n                temperature: e.attributes.temperature,\n                target_temp_low: e.attributes.min_temp,\n                target_temp_high: e.attributes.max_temp,\n                operation_mode: e.attributes.operation_mode\n            };\n            break;\n    }\n    return payload;\n});\n// Save the states\nflow.set('savedStates', entities);\n\n// create a blank message object with out new payload\nmsg = { payload: entities };\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 496,
        "y": 480,
        "wires": [
            [
                "df19bf74.0e8cc"
            ]
        ]
    },
    {
        "id": "df19bf74.0e8cc",
        "type": "debug",
        "z": "5a3565e2.10464c",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "x": 662,
        "y": 480,
        "wires": []
    },
    {
        "id": "f768d1b6.f9a73",
        "type": "inject",
        "z": "5a3565e2.10464c",
        "name": "Restore states",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 130,
        "y": 600,
        "wires": [
            [
                "4715aaf2.4e5f54"
            ]
        ]
    },
    {
        "id": "4715aaf2.4e5f54",
        "type": "change",
        "z": "5a3565e2.10464c",
        "name": "Get Saved States",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "savedStates",
                "tot": "flow"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 326,
        "y": 600,
        "wires": [
            [
                "25af091d.6b6226"
            ]
        ]
    },
    {
        "id": "ecf27eb9.31c92",
        "type": "debug",
        "z": "5a3565e2.10464c",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "x": 770,
        "y": 600,
        "wires": []
    },
    {
        "id": "25af091d.6b6226",
        "type": "split",
        "z": "5a3565e2.10464c",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 494,
        "y": 600,
        "wires": [
            [
                "e26e76f7.41a018"
            ]
        ]
    },
    {
        "id": "f110fec5.aaefe",
        "type": "api-call-service",
        "z": "5a3565e2.10464c",
        "name": "Restore States",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "",
        "service": "",
        "entityId": "",
        "data": "",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "payload",
        "output_location_type": "msg",
        "mustacheAltTags": false,
        "x": 670,
        "y": 700,
        "wires": [
            [
                "ecf27eb9.31c92"
            ]
        ]
    },
    {
        "id": "e26e76f7.41a018",
        "type": "delay",
        "z": "5a3565e2.10464c",
        "name": "",
        "pauseType": "rate",
        "timeout": "2",
        "timeoutUnits": "seconds",
        "rate": "10",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 520,
        "y": 780,
        "wires": [
            [
                "f110fec5.aaefe"
            ]
        ]
    },
    {
        "id": "5046f986.924c18",
        "type": "function",
        "z": "bec3a76b.4b57e8",
        "name": "Org data and save",
        "func": "const entities = msg.payload.map((e) => {\n    const domain = e.entity_id.split('.')[0];\n    const payload = {};\n\n    switch(domain) {\n        case 'switch':\n            payload.domain = domain;\n            payload.service = `turn_${e.state}`;\n            payload.data = {\n                entity_id: e.entity_id,\n            }\n            break;\n         case 'light':\n            payload.domain = domain;\n            payload.service = `turn_${e.state}`;\n            payload.data = {\n                entity_id: e.entity_id,\n                brightness: e.attributes.brightness,\n                color_temp: e.attributes.color_temp,\n                xy_color: e.attributes.xy_color,\n            };    \n            break;\n        case 'climate':\n            payload.domain = 'climate';\n            payload.service = `set_temperature`;\n            payload.data = {\n                entity_id: e.entity_id,\n                temperature: e.attributes.temperature,\n                target_temp_low: e.attributes.min_temp,\n                target_temp_high: e.attributes.max_temp,\n                operation_mode: e.attributes.operation_mode\n            };\n            break;\n    }\n    return payload;\n});\n// Save the states\nflow.set(msg.state_name, entities);\n\n// create a blank message object with out new payload\nmsg = { payload: entities, state_name: msg.state_name };\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 950,
        "y": 540,
        "wires": [
            [
                "5fdc398f.08c0b8"
            ]
        ]
    },
    {
        "id": "268d5ae.006fda6",
        "type": "change",
        "z": "bec3a76b.4b57e8",
        "name": "Set to save original state",
        "rules": [
            {
                "t": "set",
                "p": "state_name",
                "pt": "msg",
                "to": "original_state",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 430,
        "y": 540,
        "wires": [
            [
                "86b2e7e1.bb7a38"
            ]
        ]
    },
    {
        "id": "5fdc398f.08c0b8",
        "type": "switch",
        "z": "bec3a76b.4b57e8",
        "name": "Which state?",
        "property": "state_name",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "original_state",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "on_state",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1140,
        "y": 540,
        "wires": [
            [
                "543dfd4c.5c5054"
            ],
            [
                "5737f738.e691a8",
                "765963cc.b06e2c"
            ]
        ]
    },
    {
        "id": "543dfd4c.5c5054",
        "type": "change",
        "z": "bec3a76b.4b57e8",
        "name": "Set to save on state",
        "rules": [
            {
                "t": "set",
                "p": "state_name",
                "pt": "msg",
                "to": "on_state",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 440,
        "y": 460,
        "wires": [
            [
                "9c70ed3d.f0259"
            ]
        ]
    },
    {
        "id": "8b6bbbd7.94b878",
        "type": "delay",
        "z": "bec3a76b.4b57e8",
        "name": "Let lights turn on",
        "pauseType": "delay",
        "timeout": "1",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 970,
        "y": 460,
        "wires": [
            [
                "86b2e7e1.bb7a38"
            ]
        ]
    },
    {
        "id": "9c70ed3d.f0259",
        "type": "api-call-service",
        "z": "bec3a76b.4b57e8",
        "name": "Turn on all lights",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "light",
        "service": "turn_on",
        "entityId": "group.functional_lights",
        "data": "",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "payload",
        "output_location_type": "msg",
        "mustacheAltTags": false,
        "x": 700,
        "y": 460,
        "wires": [
            [
                "8b6bbbd7.94b878"
            ]
        ]
    },
    {
        "id": "7bb9f94f.580cc8",
        "type": "split",
        "z": "bec3a76b.4b57e8",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 510,
        "y": 1160,
        "wires": [
            [
                "4c3d14bf.8b079c"
            ]
        ]
    },
    {
        "id": "65b9ef9e.e10f5",
        "type": "api-call-service",
        "z": "bec3a76b.4b57e8",
        "name": "Restore States",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "",
        "service": "",
        "entityId": "",
        "data": "",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "payload",
        "output_location_type": "msg",
        "mustacheAltTags": false,
        "x": 880,
        "y": 1080,
        "wires": [
            [
                "81abfff4.40e7c"
            ]
        ]
    },
    {
        "id": "4c3d14bf.8b079c",
        "type": "delay",
        "z": "bec3a76b.4b57e8",
        "name": "Limit msg rate to not overload Hue",
        "pauseType": "rate",
        "timeout": "2",
        "timeoutUnits": "seconds",
        "rate": "5",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 760,
        "y": 1160,
        "wires": [
            [
                "65b9ef9e.e10f5"
            ]
        ]
    },
    {
        "id": "81abfff4.40e7c",
        "type": "join",
        "z": "bec3a76b.4b57e8",
        "name": "",
        "mode": "auto",
        "build": "string",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": "false",
        "timeout": "",
        "count": "",
        "reduceRight": false,
        "x": 1070,
        "y": 1080,
        "wires": [
            [
                "57d08dcc.be1d54"
            ]
        ]
    },
    {
        "id": "12c97065.d235b",
        "type": "function",
        "z": "bec3a76b.4b57e8",
        "name": "Get saved data",
        "func": "// Save the states\nentities = flow.get(msg.state_name);\n\n// create a blank message object with out new payload\nmsg = { payload: entities, state_name: msg.state_name };\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 620,
        "y": 1080,
        "wires": [
            [
                "7bb9f94f.580cc8"
            ]
        ]
    },
    {
        "id": "57d08dcc.be1d54",
        "type": "switch",
        "z": "bec3a76b.4b57e8",
        "name": "Which state?",
        "property": "state_name",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "on_state",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "original_state",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1250,
        "y": 1080,
        "wires": [
            [
                "b2304da.00036b"
            ],
            [
                "c2e4c267.ce43"
            ]
        ]
    },
    {
        "id": "b2304da.00036b",
        "type": "delay",
        "z": "bec3a76b.4b57e8",
        "name": "Let lights turn on",
        "pauseType": "delay",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 610,
        "y": 1000,
        "wires": [
            [
                "bdb774a9.fc7cb8"
            ]
        ]
    },
    {
        "id": "a22027dd.a3a988",
        "type": "change",
        "z": "bec3a76b.4b57e8",
        "name": "Set to restore on state",
        "rules": [
            {
                "t": "set",
                "p": "state_name",
                "pt": "msg",
                "to": "on_state",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 400,
        "y": 1080,
        "wires": [
            [
                "12c97065.d235b"
            ]
        ]
    },
    {
        "id": "bdb774a9.fc7cb8",
        "type": "change",
        "z": "bec3a76b.4b57e8",
        "name": "Set to restore original state",
        "rules": [
            {
                "t": "set",
                "p": "state_name",
                "pt": "msg",
                "to": "original_state",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 880,
        "y": 1000,
        "wires": [
            [
                "12c97065.d235b"
            ]
        ]
    },
    {
        "id": "4f8f2463.0a2c5c",
        "type": "api-call-service",
        "z": "bec3a76b.4b57e8",
        "name": "Ensure alert active",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "input_select",
        "service": "select_option",
        "entityId": "input_select.alarm_alert",
        "data": "{\"option\":\"Alert active\"}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 510,
        "y": 40,
        "wires": [
            [
                "a9af11c6.9dba1"
            ]
        ]
    },
    {
        "id": "bb6bce71.d2c1b",
        "type": "server-state-changed",
        "z": "bec3a76b.4b57e8",
        "name": "Alert just activated?",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "input_select.alarm_alert",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "Alert active",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 150,
        "y": 460,
        "wires": [
            [
                "268d5ae.006fda6",
                "8496950d.2f6188"
            ],
            []
        ]
    },
    {
        "id": "73cd822f.2b7ffc",
        "type": "api-call-service",
        "z": "bec3a76b.4b57e8",
        "name": "Set to acknowledged",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "input_select",
        "service": "select_option",
        "entityId": "input_select.alarm_alert",
        "data": "{\"option\":\"Acknowledged\"}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 760,
        "y": 100,
        "wires": [
            [
                "a9af11c6.9dba1"
            ]
        ]
    },
    {
        "id": "5688115f.ef31e",
        "type": "api-current-state",
        "z": "bec3a76b.4b57e8",
        "name": "Is alert active now?",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "outputs": 2,
        "halt_if": "Alert active",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "input_select.alarm_alert",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 510,
        "y": 100,
        "wires": [
            [
                "73cd822f.2b7ffc"
            ],
            []
        ]
    },
    {
        "id": "972f1eaf.95c4a",
        "type": "server-state-changed",
        "z": "bec3a76b.4b57e8",
        "name": "Alert acknowledged?",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "input_select.alarm_alert",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "Acknowledged",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 190,
        "y": 800,
        "wires": [
            [
                "3689482c.522928"
            ],
            []
        ]
    },
    {
        "id": "3689482c.522928",
        "type": "api-call-service",
        "z": "bec3a76b.4b57e8",
        "name": "Turn on all lights solid max alertness",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "light",
        "service": "turn_on",
        "entityId": "group.functional_lights",
        "data": "{\"brightness_pct\":100,\"color_temp\":1}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 510,
        "y": 800,
        "wires": [
            [
                "61c0d9aa.dc7c48"
            ]
        ]
    },
    {
        "id": "c71ea66a.e69218",
        "type": "server-state-changed",
        "z": "bec3a76b.4b57e8",
        "name": "Alert reset confirmed?",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "input_select.alarm_alert",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "Cleared",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 180,
        "y": 1000,
        "wires": [
            [
                "a22027dd.a3a988",
                "b551893d.2876e8"
            ],
            []
        ]
    },
    {
        "id": "b857ee27.83511",
        "type": "server-events",
        "z": "bec3a76b.4b57e8",
        "name": "Mobile notification action",
        "server": "2f5bd1e0.67e40e",
        "event_type": "mobile_app_notification_action",
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "x": 210,
        "y": 1380,
        "wires": [
            [
                "8b647146.2f88e"
            ]
        ]
    },
    {
        "id": "8b647146.2f88e",
        "type": "switch",
        "z": "bec3a76b.4b57e8",
        "name": "Which button?",
        "property": "payload.event.action",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "acknowledge_alarm",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "clear_alarm",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 440,
        "y": 1380,
        "wires": [
            [
                "7b8b357d.9c49cc"
            ],
            [
                "50d870e1.a1f82"
            ]
        ]
    },
    {
        "id": "b551893d.2876e8",
        "type": "api-call-service",
        "z": "bec3a76b.4b57e8",
        "name": "Clear reset prompt notificaiton",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "notify",
        "service": "mobile_app_sm_n970u",
        "entityId": "",
        "data": "{\"message\":\"clear_notification\",\"data\":{\"tag\":\"alarm_alert_acknowledge_clear_prompt\"}}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 450,
        "y": 920,
        "wires": [
            []
        ]
    },
    {
        "id": "d02fc76c.8f0538",
        "type": "api-call-service",
        "z": "bec3a76b.4b57e8",
        "name": "Set to cleared",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "input_select",
        "service": "select_option",
        "entityId": "input_select.alarm_alert",
        "data": "{\"option\":\"Cleared\"}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 880,
        "y": 1420,
        "wires": [
            [
                "1696f942.925c47"
            ]
        ]
    },
    {
        "id": "7b8b357d.9c49cc",
        "type": "api-current-state",
        "z": "bec3a76b.4b57e8",
        "name": "Is triggered?",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "outputs": 2,
        "halt_if": "Alert active",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "input_select.alarm_alert",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 650,
        "y": 1360,
        "wires": [
            [
                "d09da2ee.578aa"
            ],
            []
        ]
    },
    {
        "id": "d09da2ee.578aa",
        "type": "api-call-service",
        "z": "bec3a76b.4b57e8",
        "name": "Set to acknowledged",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "input_select",
        "service": "select_option",
        "entityId": "input_select.alarm_alert",
        "data": "{\"option\":\"Acknowledged\"}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 880,
        "y": 1360,
        "wires": [
            [
                "1696f942.925c47"
            ]
        ]
    },
    {
        "id": "61d8dd61.452804",
        "type": "api-call-service",
        "z": "bec3a76b.4b57e8",
        "name": "Prompt ack or clear on phone",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "notify",
        "service": "mobile_app_sm_n970u",
        "entityId": "",
        "data": "{\"title\":\"{{alarms_triggered_name}} Alarm Triggered\",\"message\":\"Acknowledge to stop flashing, clear to return lights to previous state.\",\"data\":{\"tag\":\"alarm_alert_acknowledge_clear_prompt\",\"actions\":[{\"action\":\"acknowledge_alarm\",\"title\":\"Acknowledge\"},{\"action\":\"clear_alarm\",\"title\":\"Clear and Reset\"}]}}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 1110,
        "y": 320,
        "wires": [
            []
        ]
    },
    {
        "id": "50d870e1.a1f82",
        "type": "api-current-state",
        "z": "bec3a76b.4b57e8",
        "name": "Is acknowledged?",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "outputs": 2,
        "halt_if": "Acknowledged",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "input_select.alarm_alert",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 670,
        "y": 1420,
        "wires": [
            [
                "d02fc76c.8f0538"
            ],
            []
        ]
    },
    {
        "id": "61c0d9aa.dc7c48",
        "type": "api-call-service",
        "z": "bec3a76b.4b57e8",
        "name": "Ensure alarm not triggered",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "input_boolean",
        "service": "turn_off",
        "entityId": "group.triggered_alarms",
        "data": "",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 840,
        "y": 800,
        "wires": [
            [
                "3d4179a2.a2a396"
            ]
        ]
    },
    {
        "id": "c2e4c267.ce43",
        "type": "api-call-service",
        "z": "bec3a76b.4b57e8",
        "name": "Flag to relinquish to motion",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "input_boolean",
        "service": "turn_on",
        "entityId": "input_boolean.pending_relinquish_to_motion",
        "data": "",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 1040,
        "y": 1240,
        "wires": [
            [
                "aee571f7.a9f67"
            ]
        ],
        "info": "Could do this direct on node-red, but for now going through HA to get the logging."
    },
    {
        "id": "765963cc.b06e2c",
        "type": "api-call-service",
        "z": "bec3a76b.4b57e8",
        "name": "Log alert lights to HA",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "logbook",
        "service": "log",
        "entityId": "",
        "data": "{\"name\":\"node-red\",\"message\":\"Alarm alert lights triggered. [Alarm Triggered flow]\",\"domain\":\"automation\"}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 1180,
        "y": 620,
        "wires": [
            []
        ]
    },
    {
        "id": "3d4179a2.a2a396",
        "type": "api-call-service",
        "z": "bec3a76b.4b57e8",
        "name": "Log acknowledge to HA",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "logbook",
        "service": "log",
        "entityId": "",
        "data": "{\"name\":\"node-red\",\"message\":\"Acknowledgement of alarm triggered. [Alarm Triggered flow]\",\"domain\":\"automation\"}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 1130,
        "y": 800,
        "wires": [
            []
        ]
    },
    {
        "id": "aee571f7.a9f67",
        "type": "api-call-service",
        "z": "bec3a76b.4b57e8",
        "name": "Log clear to HA",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "logbook",
        "service": "log",
        "entityId": "",
        "data": "{\"name\":\"node-red\",\"message\":\"Clear of alarm triggered. [Alarm Triggered flow]\",\"domain\":\"automation\"}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 1280,
        "y": 1240,
        "wires": [
            []
        ]
    },
    {
        "id": "1696f942.925c47",
        "type": "api-call-service",
        "z": "bec3a76b.4b57e8",
        "name": "Log phone action to HA",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "logbook",
        "service": "log",
        "entityId": "",
        "data": "{\"name\":\"node-red\",\"message\":\"Updated alarm state from phone notificaiton. [Alarm Triggered flow]\",\"domain\":\"automation\"}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 1190,
        "y": 1400,
        "wires": [
            []
        ]
    },
    {
        "id": "a9af11c6.9dba1",
        "type": "api-call-service",
        "z": "bec3a76b.4b57e8",
        "name": "Log alarm trigger to HA",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "logbook",
        "service": "log",
        "entityId": "",
        "data": "{\"name\":\"node-red\",\"message\":\"Responded to alarm trigger flag change. [Alarm Triggered flow]\",\"domain\":\"automation\"}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 1070,
        "y": 80,
        "wires": [
            []
        ]
    },
    {
        "id": "8496950d.2f6188",
        "type": "api-current-state",
        "z": "bec3a76b.4b57e8",
        "name": "Is car triggered?",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "outputs": 2,
        "halt_if": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "input_boolean.car_alarm_triggered",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 340,
        "y": 320,
        "wires": [
            [
                "bac31854.c98ae8"
            ],
            [
                "ee6d3554.429c48"
            ]
        ]
    },
    {
        "id": "bac31854.c98ae8",
        "type": "api-current-state",
        "z": "bec3a76b.4b57e8",
        "name": "Is house triggered?",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "outputs": 2,
        "halt_if": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "input_boolean.house_alarm_triggered",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 550,
        "y": 260,
        "wires": [
            [
                "e6b6648f.b62c58"
            ],
            [
                "ca1f5fef.0d014"
            ]
        ]
    },
    {
        "id": "ee6d3554.429c48",
        "type": "api-current-state",
        "z": "bec3a76b.4b57e8",
        "name": "Is house triggered?",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "outputs": 2,
        "halt_if": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "input_boolean.house_alarm_triggered",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 550,
        "y": 360,
        "wires": [
            [
                "d66aa569.2fe258"
            ],
            [
                "fbdd1f2d.f9d39"
            ]
        ]
    },
    {
        "id": "ca1f5fef.0d014",
        "type": "change",
        "z": "bec3a76b.4b57e8",
        "name": "Set name for car triggered",
        "rules": [
            {
                "t": "set",
                "p": "alarms_triggered_name",
                "pt": "msg",
                "to": "Car",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 790,
        "y": 280,
        "wires": [
            [
                "61d8dd61.452804"
            ]
        ]
    },
    {
        "id": "e6b6648f.b62c58",
        "type": "change",
        "z": "bec3a76b.4b57e8",
        "name": "Set name for both triggered",
        "rules": [
            {
                "t": "set",
                "p": "alarms_triggered_name",
                "pt": "msg",
                "to": "Car/House",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 800,
        "y": 220,
        "wires": [
            [
                "61d8dd61.452804"
            ]
        ]
    },
    {
        "id": "d66aa569.2fe258",
        "type": "change",
        "z": "bec3a76b.4b57e8",
        "name": "Set name for house triggered",
        "rules": [
            {
                "t": "set",
                "p": "alarms_triggered_name",
                "pt": "msg",
                "to": "House",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 800,
        "y": 340,
        "wires": [
            [
                "61d8dd61.452804"
            ]
        ]
    },
    {
        "id": "fbdd1f2d.f9d39",
        "type": "change",
        "z": "bec3a76b.4b57e8",
        "name": "Set name for none triggered",
        "rules": [
            {
                "t": "set",
                "p": "alarms_triggered_name",
                "pt": "msg",
                "to": "None?",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 800,
        "y": 400,
        "wires": [
            [
                "61d8dd61.452804"
            ]
        ]
    },
    {
        "id": "a14400a6.04e44",
        "type": "api-call-service",
        "z": "e393795c.3d6e88",
        "name": "Send Start to Tasker",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "rest_command",
        "service": "autoremote_mercedes_start",
        "entityId": "",
        "data": "",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 460,
        "y": 300,
        "wires": [
            [
                "557ae43.ca7501c"
            ]
        ]
    },
    {
        "id": "d4d1253e.82c2b8",
        "type": "server-state-changed",
        "z": "e393795c.3d6e88",
        "name": "Flagged to start?",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "input_boolean.pending_mercedes_start",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "habool",
        "haltifstate": "true",
        "halt_if_type": "bool",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 220,
        "y": 300,
        "wires": [
            [
                "a14400a6.04e44"
            ],
            []
        ]
    },
    {
        "id": "557ae43.ca7501c",
        "type": "api-call-service",
        "z": "e393795c.3d6e88",
        "name": "Clear start flag",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "input_boolean",
        "service": "turn_off",
        "entityId": "input_boolean.pending_mercedes_start",
        "data": "",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 700,
        "y": 300,
        "wires": [
            [
                "e2b7ecee.0930c"
            ]
        ]
    },
    {
        "id": "e2b7ecee.0930c",
        "type": "api-call-service",
        "z": "e393795c.3d6e88",
        "name": "Log execution to HA logbook",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "logbook",
        "service": "log",
        "entityId": "",
        "data": "{\"name\":\"node-red\",\"message\":\"Start Mercedes flow executed successfully.\",\"domain\":\"automation\"}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 960,
        "y": 300,
        "wires": [
            []
        ]
    },
    {
        "id": "44b3402f.62481",
        "type": "server-state-changed",
        "z": "8c544039.d793b",
        "name": "Win App changed",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "media_player.plex_jc_sb2_win_store_app",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 1,
        "output_only_on_state_change": true,
        "x": 100,
        "y": 200,
        "wires": [
            [
                "97ba1507.ec1228"
            ]
        ]
    },
    {
        "id": "97ba1507.ec1228",
        "type": "switch",
        "z": "8c544039.d793b",
        "name": "new state?",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "unavailable",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "idle",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "paused",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "playing",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 4,
        "x": 330,
        "y": 240,
        "wires": [
            [],
            [],
            [
                "999c13aa.7b7cb",
                "45c93c3.53b34c4"
            ],
            [
                "d16f99b3.609798",
                "656ea721.439f38"
            ]
        ]
    },
    {
        "id": "fd016fad.23d53",
        "type": "server-state-changed",
        "z": "8c544039.d793b",
        "name": "Chrome changed",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "media_player.plex_jc_sb2_chrome",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 1,
        "output_only_on_state_change": true,
        "x": 100,
        "y": 280,
        "wires": [
            [
                "97ba1507.ec1228"
            ]
        ]
    },
    {
        "id": "d16f99b3.609798",
        "type": "api-current-state",
        "z": "8c544039.d793b",
        "name": "Win App not playing?",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "outputs": 2,
        "halt_if": "playing",
        "halt_if_type": "str",
        "halt_if_compare": "is_not",
        "override_topic": false,
        "entity_id": "media_player.plex_jc_sb2_win_store_app",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 640,
        "y": 400,
        "wires": [
            [
                "182f45bd.cfdf0a"
            ],
            []
        ]
    },
    {
        "id": "182f45bd.cfdf0a",
        "type": "api-call-service",
        "z": "8c544039.d793b",
        "name": "Play Win App",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "media_player",
        "service": "media_play",
        "entityId": "media_player.plex_jc_sb2_win_store_app",
        "data": "",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 870,
        "y": 400,
        "wires": [
            []
        ]
    },
    {
        "id": "656ea721.439f38",
        "type": "api-current-state",
        "z": "8c544039.d793b",
        "name": "Chrome not playing?",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "outputs": 2,
        "halt_if": "playing",
        "halt_if_type": "str",
        "halt_if_compare": "is_not",
        "override_topic": false,
        "entity_id": "media_player.plex_jc_sb2_chrome",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 640,
        "y": 460,
        "wires": [
            [
                "b890ed7c.487d7"
            ],
            []
        ]
    },
    {
        "id": "b890ed7c.487d7",
        "type": "api-call-service",
        "z": "8c544039.d793b",
        "name": "Play Chrome",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "media_player",
        "service": "media_play",
        "entityId": "media_player.plex_jc_sb2_chrome",
        "data": "",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 870,
        "y": 460,
        "wires": [
            []
        ]
    },
    {
        "id": "999c13aa.7b7cb",
        "type": "api-current-state",
        "z": "8c544039.d793b",
        "name": "Win App playing?",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "outputs": 2,
        "halt_if": "playing",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "media_player.plex_jc_sb2_win_store_app",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 650,
        "y": 240,
        "wires": [
            [
                "3d6779a6.0a3236"
            ],
            [
                "d5ffe566.31f7c8"
            ]
        ]
    },
    {
        "id": "45c93c3.53b34c4",
        "type": "api-current-state",
        "z": "8c544039.d793b",
        "name": "Chrome playing?",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "outputs": 2,
        "halt_if": "playing",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "media_player.plex_jc_sb2_chrome",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 650,
        "y": 300,
        "wires": [
            [
                "d53e6667.194a68"
            ],
            []
        ]
    },
    {
        "id": "3d6779a6.0a3236",
        "type": "api-call-service",
        "z": "8c544039.d793b",
        "name": "Pause Win App",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "media_player",
        "service": "media_pause",
        "entityId": "media_player.plex_jc_sb2_win_store_app",
        "data": "",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 880,
        "y": 240,
        "wires": [
            []
        ]
    },
    {
        "id": "d53e6667.194a68",
        "type": "api-call-service",
        "z": "8c544039.d793b",
        "name": "Pause Chrome",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "media_player",
        "service": "media_pause",
        "entityId": "media_player.plex_jc_sb2_chrome",
        "data": "",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 880,
        "y": 300,
        "wires": [
            []
        ]
    },
    {
        "id": "3fa3cc39.cd2504",
        "type": "debug",
        "z": "8c544039.d793b",
        "name": "Win App Data",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "x": 1560,
        "y": 300,
        "wires": []
    },
    {
        "id": "d5ffe566.31f7c8",
        "type": "ha-get-entities",
        "z": "8c544039.d793b",
        "server": "2f5bd1e0.67e40e",
        "name": "Get Win App data",
        "rules": [
            {
                "property": "entity_id",
                "logic": "is",
                "value": "media_player.plex_jc_sb2_win_store_app",
                "valueType": "str"
            }
        ],
        "output_type": "array",
        "output_empty_results": false,
        "output_location_type": "msg",
        "output_location": "payload",
        "output_results_count": 1,
        "x": 1210,
        "y": 300,
        "wires": [
            [
                "3fa3cc39.cd2504",
                "fa145a6.411efa8",
                "1e6992fe.5f424d"
            ]
        ]
    },
    {
        "id": "fa145a6.411efa8",
        "type": "api-call-service",
        "z": "8c544039.d793b",
        "name": "Move Chrome",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "media_player",
        "service": "media_seek",
        "entityId": "media_player.plex_jc_sb2_chrome",
        "data": "{\t    \"seek_position\": msg.data.attributes.media_position\t}",
        "dataType": "jsonata",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 1450,
        "y": 360,
        "wires": [
            [
                "a21276d9.3ca768"
            ]
        ]
    },
    {
        "id": "a21276d9.3ca768",
        "type": "debug",
        "z": "8c544039.d793b",
        "name": "Worked!",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "x": 1640,
        "y": 360,
        "wires": []
    },
    {
        "id": "928708b7.030078",
        "type": "change",
        "z": "8c544039.d793b",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\t    \"test\": msg.payload[0].attributes.media_position\t}",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1400,
        "y": 440,
        "wires": [
            [
                "a21276d9.3ca768"
            ]
        ]
    },
    {
        "id": "41d289b8.c6cfc8",
        "type": "inject",
        "z": "8c544039.d793b",
        "name": "",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 1280,
        "y": 560,
        "wires": [
            [
                "d5ffe566.31f7c8"
            ]
        ]
    },
    {
        "id": "1e6992fe.5f424d",
        "type": "ha-get-entities",
        "z": "8c544039.d793b",
        "server": "2f5bd1e0.67e40e",
        "name": "Get Chrome data",
        "rules": [
            {
                "property": "entity_id",
                "logic": "is",
                "value": "media_player.plex_jc_sb2_chrome",
                "valueType": "str"
            }
        ],
        "output_type": "array",
        "output_empty_results": false,
        "output_location_type": "msg",
        "output_location": "payload",
        "output_results_count": 1,
        "x": 1410,
        "y": 220,
        "wires": [
            [
                "6b5bac77.73d874"
            ]
        ]
    },
    {
        "id": "6b5bac77.73d874",
        "type": "debug",
        "z": "8c544039.d793b",
        "name": "Chrome data",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "x": 1650,
        "y": 220,
        "wires": []
    },
    {
        "id": "be2bfeeb.ad38e",
        "type": "inject",
        "z": "8c544039.d793b",
        "name": "",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 1240,
        "y": 140,
        "wires": [
            [
                "1e6992fe.5f424d"
            ]
        ]
    },
    {
        "id": "e8831484.0e89b8",
        "type": "api-call-service",
        "z": "8c544039.d793b",
        "name": "Move Chrome",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "media_player",
        "service": "media_seek",
        "entityId": "media_player.plex_jc_sb2_chrome",
        "data": "{\"seek_position\":10}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 1480,
        "y": 700,
        "wires": [
            []
        ]
    },
    {
        "id": "1dc03f15.242ba1",
        "type": "inject",
        "z": "8c544039.d793b",
        "name": "",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 1280,
        "y": 720,
        "wires": [
            [
                "e8831484.0e89b8"
            ]
        ]
    },
    {
        "id": "6ad8e0bc.b325a",
        "type": "server-events",
        "z": "e6c80f9f.2d85a",
        "name": " Deconz Event (any)",
        "server": "2f5bd1e0.67e40e",
        "event_type": "deconz_event",
        "x": 210,
        "y": 580,
        "wires": [
            [
                "35ca298f.104e16"
            ]
        ]
    },
    {
        "id": "35ca298f.104e16",
        "type": "switch",
        "z": "e6c80f9f.2d85a",
        "name": "Is Laundry Room Button?",
        "property": "payload.event.id",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "button_st_laundry_room",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 210,
        "y": 780,
        "wires": [
            [
                "40b3d527.341c6c",
                "9e3194ff.7878b8"
            ]
        ]
    },
    {
        "id": "e643fd72.bbf38",
        "type": "api-call-service",
        "z": "e6c80f9f.2d85a",
        "name": "Turn on washer/fridge lights",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "light",
        "service": "turn_on",
        "entityId": "group.washer_and_fridge",
        "data": "",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 900,
        "y": 780,
        "wires": [
            [
                "3963d4b.c8f6a2c"
            ]
        ]
    },
    {
        "id": "40b3d527.341c6c",
        "type": "switch",
        "z": "e6c80f9f.2d85a",
        "name": "Is press?",
        "property": "payload.event.event",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "1002",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 420,
        "y": 700,
        "wires": [
            [
                "68b5974a.f10e78"
            ]
        ],
        "info": "### Samsung button event codes\n - 1001: Long press\n - 1002: Single press\n - 1004: Double press"
    },
    {
        "id": "3963d4b.c8f6a2c",
        "type": "api-call-service",
        "z": "e6c80f9f.2d85a",
        "name": "Log execution to HA logbook",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "logbook",
        "service": "log",
        "entityId": "",
        "data": "{\"name\":\"node-red\",\"message\":\"Laundry Room Light Button flow executed successfully.\",\"domain\":\"automation\"}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 1220,
        "y": 780,
        "wires": [
            []
        ]
    },
    {
        "id": "971adfa8.e711c",
        "type": "comment",
        "z": "e6c80f9f.2d85a",
        "name": "Samsung button event codes",
        "info": "### Samsung button events\n - 1001: Long press\n - 1002: Single press\n - 1004: Double press",
        "x": 440,
        "y": 460,
        "wires": []
    },
    {
        "id": "68b5974a.f10e78",
        "type": "api-current-state",
        "z": "e6c80f9f.2d85a",
        "name": "Is washer/fridge on?",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "outputs": 2,
        "halt_if": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "group.washer_and_fridge",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 620,
        "y": 700,
        "wires": [
            [
                "39f1b9bd.8e7816"
            ],
            [
                "e643fd72.bbf38"
            ]
        ]
    },
    {
        "id": "9e3194ff.7878b8",
        "type": "switch",
        "z": "e6c80f9f.2d85a",
        "name": "Is double press?",
        "property": "payload.event.event",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "1004",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 440,
        "y": 860,
        "wires": [
            [
                "fa969d60.fa40c"
            ]
        ],
        "info": "### Samsung button event codes\n - 1001: Long press\n - 1002: Single press\n - 1004: Double press"
    },
    {
        "id": "fa969d60.fa40c",
        "type": "api-current-state",
        "z": "e6c80f9f.2d85a",
        "name": "Is e-box on?",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "outputs": 2,
        "halt_if": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "light.laundry_electrical_box",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 630,
        "y": 860,
        "wires": [
            [
                "39f1b9bd.8e7816"
            ],
            [
                "22bf1bde.9d54f4"
            ]
        ]
    },
    {
        "id": "39f1b9bd.8e7816",
        "type": "api-call-service",
        "z": "e6c80f9f.2d85a",
        "name": "Turn off laundry room lights",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "light",
        "service": "turn_off",
        "entityId": "group.laundry_room",
        "data": "",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 900,
        "y": 660,
        "wires": [
            [
                "3963d4b.c8f6a2c"
            ]
        ]
    },
    {
        "id": "22bf1bde.9d54f4",
        "type": "api-call-service",
        "z": "e6c80f9f.2d85a",
        "name": "Turn on laundry room lights",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "light",
        "service": "turn_on",
        "entityId": "group.laundry_room",
        "data": "",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 900,
        "y": 920,
        "wires": [
            [
                "3963d4b.c8f6a2c"
            ]
        ]
    },
    {
        "id": "39cd40b7.f1b2e",
        "type": "server-events",
        "z": "7a29c613.b063d8",
        "name": " Deconz Event (any)",
        "server": "2f5bd1e0.67e40e",
        "event_type": "deconz_event",
        "x": 150,
        "y": 720,
        "wires": [
            [
                "b55ef9de.458e68"
            ]
        ]
    },
    {
        "id": "b55ef9de.458e68",
        "type": "switch",
        "z": "7a29c613.b063d8",
        "name": "Is Living Room Switch?",
        "property": "payload.event.id",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "switch_hue_living_room",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 190,
        "y": 800,
        "wires": [
            [
                "e019762.dd47f88",
                "cbd66a92.d0b1c8",
                "8692e443.9a2b48",
                "f75dd00c.e4817"
            ]
        ]
    },
    {
        "id": "e019762.dd47f88",
        "type": "switch",
        "z": "7a29c613.b063d8",
        "name": "Is on button?",
        "property": "payload.event.event",
        "propertyType": "msg",
        "rules": [
            {
                "t": "regex",
                "v": "1\\d+",
                "vt": "str",
                "case": false
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 450,
        "y": 500,
        "wires": [
            [
                "b13a67ab.b5e0e8",
                "576f5102.3fbda"
            ]
        ],
        "info": "### Samsung button event codes\n - 1001: Long press\n - 1002: Single press\n - 1004: Double press"
    },
    {
        "id": "790012f9.dd246c",
        "type": "api-call-service",
        "z": "7a29c613.b063d8",
        "name": "Log execution to HA logbook",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "logbook",
        "service": "log",
        "entityId": "",
        "data": "{\"name\":\"node-red\",\"message\":\"Living Room Switch flow executed successfully.\",\"domain\":\"automation\"}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 1300,
        "y": 800,
        "wires": [
            []
        ]
    },
    {
        "id": "dae74b5b.f30368",
        "type": "comment",
        "z": "7a29c613.b063d8",
        "name": "Samsung switch event codes",
        "info": "## Samsung switch events\n\n### Which button\n - 1xxx: On\n - 2xxx: Brighter\n - 3xxx: Darker\n - 4xxx: Off\n\n### Which event\n - xxx0: Button down-press\n - xxx1: Periodic hold report (1 per sec)\n - xxx2: Button up-release (not held)\n - xxx3: Button up-release (after held)",
        "x": 200,
        "y": 420,
        "wires": []
    },
    {
        "id": "cbd66a92.d0b1c8",
        "type": "switch",
        "z": "7a29c613.b063d8",
        "name": "Is brighter button?",
        "property": "payload.event.event",
        "propertyType": "msg",
        "rules": [
            {
                "t": "regex",
                "v": "2\\d+",
                "vt": "str",
                "case": false
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 470,
        "y": 700,
        "wires": [
            [
                "c7fcab94.a760b8",
                "85c57ffb.e1d62"
            ]
        ],
        "info": "### Samsung button event codes\n - 1001: Long press\n - 1002: Single press\n - 1004: Double press"
    },
    {
        "id": "8692e443.9a2b48",
        "type": "switch",
        "z": "7a29c613.b063d8",
        "name": "Is darker button?",
        "property": "payload.event.event",
        "propertyType": "msg",
        "rules": [
            {
                "t": "regex",
                "v": "3\\d+",
                "vt": "str",
                "case": false
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 470,
        "y": 900,
        "wires": [
            [
                "70b2e202.5bde1c",
                "69e579da.2282f8"
            ]
        ],
        "info": "### Samsung button event codes\n - 1001: Long press\n - 1002: Single press\n - 1004: Double press"
    },
    {
        "id": "f75dd00c.e4817",
        "type": "switch",
        "z": "7a29c613.b063d8",
        "name": "Is off button?",
        "property": "payload.event.event",
        "propertyType": "msg",
        "rules": [
            {
                "t": "regex",
                "v": "4\\d+",
                "vt": "str",
                "case": false
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 450,
        "y": 1100,
        "wires": [
            [
                "394451d5.cbd38e",
                "ca0286e5.eec9b8"
            ]
        ],
        "info": "### Samsung button event codes\n - 1001: Long press\n - 1002: Single press\n - 1004: Double press"
    },
    {
        "id": "b13a67ab.b5e0e8",
        "type": "switch",
        "z": "7a29c613.b063d8",
        "name": "Is held?",
        "property": "payload.event.event",
        "propertyType": "msg",
        "rules": [
            {
                "t": "regex",
                "v": "\\d+1",
                "vt": "str",
                "case": false
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 680,
        "y": 460,
        "wires": [
            [
                "df9fc1d3.af523"
            ]
        ],
        "info": "### Samsung button event codes\n - 1001: Long press\n - 1002: Single press\n - 1004: Double press"
    },
    {
        "id": "576f5102.3fbda",
        "type": "switch",
        "z": "7a29c613.b063d8",
        "name": "Was tapped?",
        "property": "payload.event.event",
        "propertyType": "msg",
        "rules": [
            {
                "t": "regex",
                "v": "\\d+2",
                "vt": "str",
                "case": false
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 690,
        "y": 540,
        "wires": [
            [
                "df9fc1d3.af523"
            ]
        ],
        "info": "### Samsung button event codes\n - 1001: Long press\n - 1002: Single press\n - 1004: Double press"
    },
    {
        "id": "c7fcab94.a760b8",
        "type": "switch",
        "z": "7a29c613.b063d8",
        "name": "Is held?",
        "property": "payload.event.event",
        "propertyType": "msg",
        "rules": [
            {
                "t": "regex",
                "v": "\\d+1",
                "vt": "str",
                "case": false
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 680,
        "y": 660,
        "wires": [
            []
        ],
        "info": "### Samsung button event codes\n - 1001: Long press\n - 1002: Single press\n - 1004: Double press"
    },
    {
        "id": "85c57ffb.e1d62",
        "type": "switch",
        "z": "7a29c613.b063d8",
        "name": "Was tapped?",
        "property": "payload.event.event",
        "propertyType": "msg",
        "rules": [
            {
                "t": "regex",
                "v": "\\d+2",
                "vt": "str",
                "case": false
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 690,
        "y": 740,
        "wires": [
            []
        ],
        "info": "### Samsung button event codes\n - 1001: Long press\n - 1002: Single press\n - 1004: Double press"
    },
    {
        "id": "70b2e202.5bde1c",
        "type": "switch",
        "z": "7a29c613.b063d8",
        "name": "Is held?",
        "property": "payload.event.event",
        "propertyType": "msg",
        "rules": [
            {
                "t": "regex",
                "v": "\\d+1",
                "vt": "str",
                "case": false
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 680,
        "y": 860,
        "wires": [
            []
        ],
        "info": "### Samsung button event codes\n - 1001: Long press\n - 1002: Single press\n - 1004: Double press"
    },
    {
        "id": "69e579da.2282f8",
        "type": "switch",
        "z": "7a29c613.b063d8",
        "name": "Was tapped?",
        "property": "payload.event.event",
        "propertyType": "msg",
        "rules": [
            {
                "t": "regex",
                "v": "\\d+2",
                "vt": "str",
                "case": false
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 690,
        "y": 940,
        "wires": [
            []
        ],
        "info": "### Samsung button event codes\n - 1001: Long press\n - 1002: Single press\n - 1004: Double press"
    },
    {
        "id": "394451d5.cbd38e",
        "type": "switch",
        "z": "7a29c613.b063d8",
        "name": "Is held?",
        "property": "payload.event.event",
        "propertyType": "msg",
        "rules": [
            {
                "t": "regex",
                "v": "\\d+1",
                "vt": "str",
                "case": false
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 680,
        "y": 1060,
        "wires": [
            [
                "3bc1c346.3473ec"
            ]
        ],
        "info": "### Samsung button event codes\n - 1001: Long press\n - 1002: Single press\n - 1004: Double press"
    },
    {
        "id": "ca0286e5.eec9b8",
        "type": "switch",
        "z": "7a29c613.b063d8",
        "name": "Was tapped?",
        "property": "payload.event.event",
        "propertyType": "msg",
        "rules": [
            {
                "t": "regex",
                "v": "\\d+2",
                "vt": "str",
                "case": false
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 690,
        "y": 1140,
        "wires": [
            [
                "3bc1c346.3473ec"
            ]
        ],
        "info": "### Samsung button event codes\n - 1001: Long press\n - 1002: Single press\n - 1004: Double press"
    },
    {
        "id": "df9fc1d3.af523",
        "type": "api-call-service",
        "z": "7a29c613.b063d8",
        "name": "Turn on living room lights",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "light",
        "service": "turn_on",
        "entityId": "group.living_room",
        "data": "",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 970,
        "y": 540,
        "wires": [
            [
                "790012f9.dd246c"
            ]
        ]
    },
    {
        "id": "3bc1c346.3473ec",
        "type": "api-call-service",
        "z": "7a29c613.b063d8",
        "name": "Turn off living room lights",
        "server": "2f5bd1e0.67e40e",
        "version": 1,
        "debugenabled": false,
        "service_domain": "light",
        "service": "turn_off",
        "entityId": "group.living_room",
        "data": "",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 970,
        "y": 1140,
        "wires": [
            [
                "790012f9.dd246c"
            ]
        ]
    },
    {
        "id": "f9323302.f0f7f",
        "type": "ha-get-entities",
        "z": "7a29c613.b063d8",
        "server": "2f5bd1e0.67e40e",
        "name": "Get individual light states",
        "rules": [
            {
                "property": "",
                "logic": "jsonata",
                "value": "$exists($entity().attributes.is_hue_group) = false",
                "valueType": "jsonata"
            },
            {
                "property": "entity_id",
                "logic": "starts_with",
                "value": "light.",
                "valueType": "str"
            },
            {
                "property": "entity_id",
                "logic": "in_group",
                "value": "group.office",
                "valueType": "str"
            }
        ],
        "output_type": "array",
        "output_empty_results": false,
        "output_location_type": "msg",
        "output_location": "payload",
        "output_results_count": 1,
        "x": 570,
        "y": 1420,
        "wires": [
            [
                "96eb3b90.a41bc8",
                "9f63c710.604598"
            ]
        ],
        "info": "This filters out hue groups since lights within a group may have different settings (which it looks like Hue just \"averages\" the settings to report a single number set for all of the lights)."
    },
    {
        "id": "8671331d.dcdd3",
        "type": "inject",
        "z": "7a29c613.b063d8",
        "name": "",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 340,
        "y": 1420,
        "wires": [
            [
                "f9323302.f0f7f"
            ]
        ]
    },
    {
        "id": "96eb3b90.a41bc8",
        "type": "debug",
        "z": "7a29c613.b063d8",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "x": 820,
        "y": 1420,
        "wires": []
    },
    {
        "id": "3af7ac4e.e1f074",
        "type": "function",
        "z": "7a29c613.b063d8",
        "name": "Inc or dec brightness by 10%",
        "func": "var min_bright = null;\nvar max_bright = null;\nvar new_bright = null;\n\nvar inc_dec_pct = 0.1;\n\nfunction inc_bright(old_bright) {\n    if (!old_bright) {\n        return null;\n    }\n    \n    // Add 1 in case off from last conversion\n    var old_bright_pct = (old_bright+1)/255;\n    var new_bright_pct = old_bright_pct + inc_dec_pct;\n    // Want to round to nearest 10%\n    new_bright_pct = Math.round(new_bright_pct*10)/10;\n    \n    var new_inc_bright = Math.round(new_bright_pct * 255);\n    new_inc_bright = Math.min(new_inc_bright, 255);\n    return new_inc_bright;\n}\n\n\nfunction dec_bright(old_bright) {\n    if (!old_bright) {\n        return null;\n    }\n    \n    // Subtract 1 in case off from last conversion\n    var old_bright_pct = (old_bright-1)/255;\n    var new_bright_pct = old_bright_pct - inc_dec_pct;\n    // Want to round to nearest 10%\n    new_bright_pct = Math.round(new_bright_pct*10)/10;\n    \n    var new_dec_bright = Math.round(new_bright_pct * 255);\n    new_dec_bright = Math.max(new_dec_bright, 1);\n    return new_dec_bright;\n}\n\n\nmsg.payload.forEach(function(value, index) {\n    if (!(value.attributes.brightness)) {\n        return;\n    }\n    \n    if (min_bright===null ||\n            value.attributes.brightness < min_bright) {\n        min_bright = value.attributes.brightness;\n    }\n    \n    if (max_bright===null ||\n            value.attributes.brightness > max_bright) {\n        max_bright = value.attributes.brightness;\n    }\n})\n\n\nif (msg.config.inc_or_dec == 'increase') {\n    new_bright = inc_bright(min_bright)\n} else if (msg.config.inc_or_dec == 'decrease') {\n    new_bright = dec_bright(max_bright)\n}\n// Else leave new_bright as null\n\nif (new_bright===null) {\n    return null;\n}\n\nmsg.config.new_brightness = new_bright;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 600,
        "y": 1520,
        "wires": [
            [
                "856925a9.efc968",
                "4eaf6593.624d7c"
            ]
        ]
    },
    {
        "id": "856925a9.efc968",
        "type": "debug",
        "z": "7a29c613.b063d8",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "x": 810,
        "y": 1480,
        "wires": []
    },
    {
        "id": "badabe74.349a6",
        "type": "change",
        "z": "7a29c613.b063d8",
        "name": "Flag to increase",
        "rules": [
            {
                "t": "set",
                "p": "config",
                "pt": "msg",
                "to": "{}",
                "tot": "json"
            },
            {
                "t": "set",
                "p": "config.inc_or_dec",
                "pt": "msg",
                "to": "increase",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 340,
        "y": 1520,
        "wires": [
            [
                "3af7ac4e.e1f074"
            ]
        ]
    },
    {
        "id": "9f63c710.604598",
        "type": "change",
        "z": "7a29c613.b063d8",
        "name": "Flag to decrease",
        "rules": [
            {
                "t": "set",
                "p": "config",
                "pt": "msg",
                "to": "{}",
                "tot": "json"
            },
            {
                "t": "set",
                "p": "config.inc_or_dec",
                "pt": "msg",
                "to": "decrease",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 350,
        "y": 1580,
        "wires": [
            [
                "3af7ac4e.e1f074"
            ]
        ]
    },
    {
        "id": "4eaf6593.624d7c",
        "type": "function",
        "z": "7a29c613.b063d8",
        "name": "All or individual lights?",
        "func": "const all_on = msg.payload.every(e => e.state=='on');\n\nif (all_on) {\n    return [msg, null];\n}\n\nvar new_msgs = [];\n\nmsg.payload.forEach((e) => {\n    if (e.state == 'off') {\n        return;\n    }\n    \n    if (msg.config.inc_or_dec == 'increase') {\n        if (e.attributes.brightness >=\n                msg.config.new_brightness) {\n            return;\n        }\n    } else if (msg.config.inc_or_dec == 'decrease') {\n        if (e.attributes.brightness <=\n                msg.config.new_brightness) {\n            return;\n        }\n    } else {\n        return;\n    }\n    \n    const payload = {};\n    payload.domain = 'light';\n    payload.service = 'turn_on';\n    payload.data = {\n        entity_id: e.entity_id,\n        brightness: msg.config.new_brightness,\n    }\n    \n    new_msgs.push({ payload: payload });\n});\n\nreturn [null, new_msgs];",
        "outputs": 2,
        "noerr": 0,
        "x": 840,
        "y": 1600,
        "wires": [
            [
                "9ae4db61.c21968"
            ],
            [
                "669c04d7.ddf07c"
            ]
        ]
    },
    {
        "id": "9ae4db61.c21968",
        "type": "debug",
        "z": "7a29c613.b063d8",
        "name": "all_on",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "x": 1030,
        "y": 1560,
        "wires": []
    },
    {
        "id": "669c04d7.ddf07c",
        "type": "debug",
        "z": "7a29c613.b063d8",
        "name": "some_off",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "x": 1040,
        "y": 1640,
        "wires": []
    }
]